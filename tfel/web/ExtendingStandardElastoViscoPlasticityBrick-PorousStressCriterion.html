<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-EN" xml:lang="en-EN">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="generator" content="pandoc" />
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>Extending the StandardElastoViscoPlasticity brick with a new porous stress criterion</title>
        <meta name="author" content="Thomas Helfer, Jérémy Hure, Mohamed Shokeir" />
            <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
    <style type="text/css">code{white-space: pre;}</style>
            <style type="text/css">
      a.sourceLine { display: inline-block; line-height: 1.25; }
      a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
      a.sourceLine:empty { height: 1.2em; position: absolute; }
      .sourceCode { overflow: visible; }
      code.sourceCode { white-space: pre; position: relative; }
      div.sourceCode { margin: 1em 0; }
      pre.sourceCode { margin: 0; }
      @media screen {
      div.sourceCode { overflow: auto; }
      }
      @media print {
      code.sourceCode { white-space: pre-wrap; }
      a.sourceLine { text-indent: -1em; padding-left: 1em; }
      }
      pre.numberSource a.sourceLine
        { position: relative; }
      pre.numberSource a.sourceLine:empty
        { position: absolute; }
      pre.numberSource a.sourceLine::before
        { content: attr(data-line-number);
          position: absolute; left: -5em; text-align: right; vertical-align: baseline;
          border: none; pointer-events: all;
          -webkit-touch-callout: none; -webkit-user-select: none;
          -khtml-user-select: none; -moz-user-select: none;
          -ms-user-select: none; user-select: none;
          padding: 0 4px; width: 4em;
          color: #aaaaaa;
        }
      pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
      div.sourceCode
        { background-color: #f8f8f8; }
      @media screen {
      a.sourceLine::before { text-decoration: underline; }
      }
      code span.al { color: #ef2929; } /* Alert */
      code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
      code span.at { color: #c4a000; } /* Attribute */
      code span.bn { color: #0000cf; } /* BaseN */
      code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
      code span.ch { color: #4e9a06; } /* Char */
      code span.cn { color: #000000; } /* Constant */
      code span.co { color: #8f5902; font-style: italic; } /* Comment */
      code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
      code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
      code span.dt { color: #204a87; } /* DataType */
      code span.dv { color: #0000cf; } /* DecVal */
      code span.er { color: #a40000; font-weight: bold; } /* Error */
      code span.ex { } /* Extension */
      code span.fl { color: #0000cf; } /* Float */
      code span.fu { color: #000000; } /* Function */
      code span.im { } /* Import */
      code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
      code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
      code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
      code span.ot { color: #8f5902; } /* Other */
      code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
      code span.sc { color: #000000; } /* SpecialChar */
      code span.ss { color: #4e9a06; } /* SpecialString */
      code span.st { color: #4e9a06; } /* String */
      code span.va { color: #000000; } /* Variable */
      code span.vs { color: #4e9a06; } /* VerbatimString */
      code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
    </style>
            <link rel="stylesheet" href="css/normalize.css"/>
    <link rel="stylesheet" href="css/main.css"/>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS_CHTML-full" type="text/javascript"></script>
          </head>
  <body>
    <!--[if lt IE 7]>
        <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
    <![endif]-->
        <header>
      <ul id="nav">
	<li><a href="news.html">News</a></li>
	<li><a href="index.html">Overview</a>
	  <ul>
	    <li><a>Domain specific languages</a>
	      <ul>
		<li><a href="material-properties.html">Material properties</a></li>
		<li><a href="behaviours.html">Mechanical behaviours</a></li>
		<li><a href="models.html">Models</a></li>
	      </ul>
            </li>
	    <li><a href="interfaces.html">Interfaces</a></li>
	    <li><a href="mfront-doc.html">mfront-doc</a></li>
	    <li><a href="mtest.html">mtest</a></li>
	    <li><a href="mfm.html">mfm</a></li>
	    <li><a href="mfm-test-generator.html">mfm</a></li>
	  </ul>
	</li>
	<li><a>Getting started</a>
	  <ul>
	    <li><a href="https://sourceforge.net/projects/tfel/files">Download</a></li>
	    <li><a href="release-notes.html">Release notes</a>
	    <ul>
            <li><a>Versions 2.0.x</a>
                <ul>
                <li><a href="release-notes.html">Versions prior to 2.0.5</a><li>
	 	       <li><a href="release-notes-2.0.5.html">Version 2.0.5</a><li>
                </ul>
            </li>
            <li><a>Versions 3.0.x</a>
                <ul>
                    <li><a href="release-notes-3.0.html">Version 3.0.0</a><li>
		           <li><a href="release-notes-3.0.1.html">Version 3.0.1</a><li>
                    <li><a href="release-notes-3.0.2.html">Version 3.0.2</a><li>
		           <li><a href="release-notes-3.0.3.html">Version 3.0.3</a><li>
		           <li><a href="release-notes-3.0.4.html">Version 3.0.4</a><li>
		           <li><a href="release-notes-3.0.5.html">Version 3.0.5</a><li>
		           <li><a href="release-notes-3.0.6.html">Version 3.0.6</a><li>
                </ul>
           </li>
            <li><a>Versions 3.1.x</a>
                <ul>
		<li><a href="release-notes-3.1.html">Version 3.1.0</a><li>
		<li><a href="release-notes-3.1.1.html">Version 3.1.1</a><li>
		<li><a href="release-notes-3.1.2.html">Version 3.1.2</a><li>
		<li><a href="release-notes-3.1.3.html">Version 3.1.3</a><li>
		<li><a href="release-notes-3.1.4.html">Version 3.1.4</a><li>
		<li><a href="release-notes-3.1.5.html">Version 3.1.5</a><li>
                </ul>
           </li>
            <li><a>Versions 3.2.x</a>
                <ul>
		           <li><a href="release-notes-3.2.html">Version 3.2.0</a><li>
		           <li><a href="release-notes-3.2.1.html">Version 3.2.1</a><li>
		           <li><a href="release-notes-3.2.2.html">Version 3.2.2</a><li>
                </ul>
           </li>
            <li><a>Versions 3.3.x</a>
                <ul>
		           <li><a href="release-notes-3.3.html">Version 3.3.0</a><li>
		           <li><a href="release-notes-3.3.1.html">Version 3.3.1</a><li>
                </ul>
           </li>
            <li><a>Versions 3.4.x</a>
                <ul>
		           <li><a href="release-notes-3.4.html">Version 3.4.0</a><li>
                </ul>
           </li>
	      </ul>
	    </li>
	    <li><a href="coverity-scan.html">Coverity scan</a></li>
	    <li><a href="install.html">Installation</a></li>
	  </ul>
	</li>
	<li><a>Documentation</a>
	  <ul>
	    <li><a href="documentations.html">General documentation</a></li>
	    <li><a href="gallery.html">Gallery</a></li>
	    <li><a href="http://tfel.sourceforge.net/doxygen/index.html">Doxygen documentation</a></li>
	    <li><a>Behaviours</a>
	      <ul>
		<li><a href="tutorial.html">Tutorial</a></li>
		<li><a href="implicit-dsl.html">The implicit DSL</a></li>
		<li><a href="benchmark.html">Benchmark</a></li>
		<li><a href="parameters.html">Parameters</a></li>
		<li><a href="BehaviourBricks.html">Behaviour bricks</a></li>
		<li><a href="interfaces.html">Solver interfaces</a>
		  <ul>
		    <li><a href="castem.html">Cast3M</a></li>
		    <li><a href="aster.html">Code-Aster</a></li>
    		    <li><a href="abaqus.html">Abaqus</a></li>
    		    <li><a href="epx.html">EUROPLEXUS</a></li>
		    <li><a href="zmat.html">ZeBuLoN</a></li>
   		    <li><a href="calculix.html">CalculiX</a></li>
		    <!-- <li><a >TMFFT</a></li> -->
		    <li><a href="cyrano.html">Cyrano</a></li>
   		    <li><a href="generic-behaviours-interface.html">Generic Behaviour Interface</a></li>
		  </ul>
		</li>
	      </ul>
	    </li>
	    <li><a>TFEL libraries</a>
	      <ul>
		<li><a href="material.html">TFEL/Material</a></li>
	      </ul>
	    </li>
	    <li><a>Python modules</a>
	      <ul>
		<li><a href="tfel-python.html">TFEL modules</a></li>
		<li><a href="mfront-python.html">mfront module</a></li>
		<li><a href="mtest-python.html">mtest module</a></li>
	      </ul>
	    </li>
	    <li><a>MFront keywords</a>
	      <ul>
		<li><a href="DefaultDSL-keywords.html">DefaultDSL</a></li> 
		<li><a href="DefaultCZMDSL-keywords.html">DefaultCZMDSL</a></li> 
		<li><a href="DefaultFiniteStrainDSL-keywords.html">DefaultFiniteStrainDSL</a></li> 
		<li><a href="Implicit-keywords.html">Implicit</a></li> 
		<li><a href="ImplicitFiniteStrain-keywords.html">ImplicitFiniteStrain</a></li> 
		<li><a href="ImplicitII-keywords.html">ImplicitII</a></li> 
		<li><a href="IsotropicMisesCreep-keywords.html">IsotropicMisesCreep</a></li> 
		<li><a href="IsotropicPlasticMisesFlow-keywords.html">IsotropicPlasticMisesFlow</a></li> 
		<li><a href="IsotropicStrainHardeningMisesCreep-keywords.html">IsotropicStrainHardeningMisesCreep</a></li> 
		<li><a href="MaterialLaw-keywords.html">MaterialLaw</a></li> 
		<li><a href="Model-keywords.html">Model</a></li> 
		<li><a href="MultipleIsotropicMisesFlows-keywords.html">MultipleIsotropicMisesFlows</a></li> 
		<li><a href="RungeKutta-keywords.html">RungeKutta</a></li> 
	      </ul>
	    </li>
	    <li><a href="MTest-keywords.html">MTest keywords</a></li>
	    <li><a href="physical-constants.html">Physical constants</a></li>
	    <li><a href="glossary.html">Glossary</a></li>
	    <li><a href="publications.html">Publications</a></li>
	    <li><a href="faq.html">FAQ</a></li>
	    <li><a href="about.html">About</a></li>
	  </ul>
	</li>
	<li><a>Contributing</a>
	  <ul>
	    <li><a href="svn.html">Access to source repositories</a></li>
	    <li><a href="devel.html">Development guidelines</a></li>
	    <li><a href="http://sourceforge.net/p/tfel/tickets">Report bugs</a></li>
	  </ul>
	</li>
	<li><a>Getting Help</a>
	  <ul>
	    <li><a href="search.html">Search on this site</a></li>
	    <li><a href="http://sourceforge.net/p/tfel/discussion">Forum</a></li>
	    <li><a href="http://sourceforge.net/p/tfel/tfel">Mailing lists</a></li>
	    <li><a href="mailto:tfel-contact@cea.fr">Contact</a></li>
	  </ul>
	</li>
      </ul>
    </header>
    <br></br>
        <div id="header">
      <h1 class="title">Extending the <code>StandardElastoViscoPlasticity</code> brick with a new porous stress criterion</h1>
                  <h2 class="author">Thomas Helfer, Jérémy Hure, Mohamed Shokeir</h2>
                  <h3 class="date">07/2020</h3>
          </div>
            <div id="TOC">
      <ul>
      <li><a href="#extending-the-tfelmaterial-library"><span class="toc-section-number">1</span> Extending the <code>TFEL/Material</code> library</a><ul>
      <li><a href="#template-files"><span class="toc-section-number">1.1</span> Template files</a></li>
      <li><a href="#creating-a-proper-working-directory-for-the-example-of-the-so-called-hollow-sphere-criterion-proposed-by-michel-and-suquet"><span class="toc-section-number">1.2</span> Creating a proper working directory for the example of the so-called hollow sphere criterion proposed by Michel and Suquet</a></li>
      <li><a href="#implementing-the-michel-and-suquet-hollow-sphere-stress-criterion"><span class="toc-section-number">1.3</span> Implementing the Michel and Suquet’ hollow sphere stress criterion</a></li>
      <li><a href="#testing-the-derivatives-advanced-and-optional"><span class="toc-section-number">1.4</span> Testing the derivatives (advanced and optional)</a></li>
      <li><a href="#modifying-the-mfront-implementations"><span class="toc-section-number">1.5</span> Modifying the <code>MFront</code> implementations</a></li>
      </ul></li>
      <li><a href="#extending-the-tfelmfront-library"><span class="toc-section-number">2</span> Extending the <code>TFELMFront</code> library</a><ul>
      <li><a href="#updating-the-working-directory"><span class="toc-section-number">2.1</span> Updating the working directory</a></li>
      <li><a href="#adding-the-stress-criterion-options"><span class="toc-section-number">2.2</span> Adding the stress criterion options</a></li>
      <li><a href="#compilation-of-the-mfront-plugin"><span class="toc-section-number">2.3</span> Compilation of the <code>MFront</code> plugin</a></li>
      <li><a href="#testing-the-plugin"><span class="toc-section-number">2.4</span> Testing the plugin</a></li>
      </ul></li>
      <li><a href="#applications-to-uranimum-dioxyde-viscoplastic-behaviours"><span class="toc-section-number">3</span> Applications to uranimum dioxyde viscoplastic behaviours</a><ul>
      <li><a href="#implementation-of-salvo-viscoplastic-behaviour"><span class="toc-section-number">3.1</span> Implementation of Salvo’ viscoplastic behaviour</a></li>
      <li><a href="#coupling-of-the-salvo-viscoplastic-behaviour-with-the-ddif2-damage-law"><span class="toc-section-number">3.2</span> Coupling of the Salvo’ viscoplastic behaviour with the <code>DDIF2</code> damage law</a></li>
      </ul></li>
      <li><a href="#references">References</a></li>
      </ul>
    </div>
        

<p>This document gives some insights on how a user may extend the <code>StandardElastoViscoPlasticity</code> brick by adding a new stress criterion coupled with porosity evolution.</p>
<p>The <code>StandardElastoViscoPlasticity</code> brick is fully described <a href="StandardElastoViscoPlasticityBrick.html">here</a>.</p>
<p>Introducing a new porous stress criterion in the <code>StandardElastoViscoPlasticity</code> brick has two main steps:</p>
<ul>
<li>Extending the <code>TFEL/Material</code> library.</li>
<li>Extending the <code>TFELMFront</code> library.</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p>This tutorial only covers <em>isotropic</em> stress criteria. Orthotropic stress criteria requires to take care of the orthotropic axes convention.</p>
<p>See the documentation of the <code>@OrthotropicBehaviour</code> keyword for details:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="ex">mfront</span> --help-keyword=Implicit:@OrthotropicBehaviour</a></code></pre></div>
</blockquote>
<p>Those steps are illustrated by the implementation so-called hollow sphere criterion proposed by Michel and Suquet which describe the macroscopic viscoplasticty of a porous material by the following law (see <span class="citation" data-cites="michel_constitutive_1992">[<a href="#ref-michel_constitutive_1992">1</a>]</span>):</p>
<p>The viscoplastic strain rate is defined by:</p>
<p><span class="math display">\[
\underline{\dot{\varepsilon}}^{\mathrm{vp}}=\dot{\varepsilon}_{0}\,{\left({{\displaystyle \frac{\displaystyle \sigma_{\mathrm{eq}}^{MS}}{\displaystyle \sigma_{0}}}}\right)}^{E}\,\underline{n}^{MS}
\]</span></p>
<p>where:</p>
<ul>
<li><span class="math inline">\(\dot{\varepsilon}_{0}\)</span> is a reference strain rate which shall be identified.</li>
<li><span class="math inline">\(\sigma_{0}\)</span> is a reference stress used to normalise the stress.</li>
<li><span class="math inline">\(E\)</span> is the Norton exponent.</li>
</ul>
<p>The stress criterion <span class="math inline">\(\sigma_{\mathrm{eq}}^{MS}\)</span> is defined by:</p>
<p><span class="math display">\[
\sigma_{\mathrm{eq}}^{MS}=\sqrt{{{\displaystyle \frac{\displaystyle 9}{\displaystyle 4}}}\,A{\left(f\right)}\,p^{2}+B{\left(f\right)}\,\sigma_{\mathrm{eq}}^{2}}
\]</span></p>
<p>where:</p>
<ul>
<li><span class="math inline">\(p\)</span> is the hydrostatic pressure (<span class="math inline">\(p={{\displaystyle \frac{\displaystyle 1}{\displaystyle 3}}}{\mathrm{tr}{\left(\underline{\sigma}\right)}}\)</span>).</li>
<li><span class="math inline">\(\sigma_{\mathrm{eq}}\)</span> is the von Mises stress.</li>
<li><span class="math inline">\(A{\left(f\right)}={\left(n\,{\left(f^{-1/n}-1\right)}\right)}^{\frac{-2\,n}{n+1}}\)</span></li>
<li><span class="math inline">\(B{\left(f\right)}={\left(1+{{\displaystyle \frac{\displaystyle 2}{\displaystyle 3}}}\,f\right)}\,{\left(1-f\right)}^{\frac{-2\,n}{n+1}}\)</span></li>
<li><span class="math inline">\(n\)</span> is the Norton exponent of the matrix</li>
</ul>
<p>This flow is associated, to the flow direction is given by:</p>
<p><span class="math display">\[
\underline{n}^{MS}={\displaystyle \frac{\displaystyle \partial \sigma_{\mathrm{eq}}^{MS}}{\displaystyle \partial \underline{\sigma}}}
\]</span></p>
<blockquote>
<p><strong>Implicit schemes</strong></p>
<p>This document assumes that the reader has prior knowledge on how the integrate a behaviour using an implicit scheme with <code>MFront</code>.</p>
<p>Appropriate introductory materials are given in the <a href="gallery.html">gallery</a>.</p>
</blockquote>
<h1 id="extending-the-tfelmaterial-library"><span class="header-section-number">1</span> Extending the <code>TFEL/Material</code> library</h1>
<h2 id="template-files"><span class="header-section-number">1.1</span> Template files</h2>
<p>We recommend that you use the following template files:</p>
<ul>
<li><a href="cxx/include/TFEL/Material/PorousStressCriterionTemplate.hxx"><code>PorousStressCriterionTemplate.hxx</code></a></li>
<li><a href="cxx/include/TFEL/Material/PorousStressCriterionTemplate.ixx"><code>PorousStressCriterionTemplate.ixx</code></a></li>
<li><a href="mfront/PorousStressCriterionTest.mfront"><code>PorousStressCriterionTest.mfront</code></a></li>
<li><a href="mfront/PorousStressCriterionTest_NumericalJacobian.mfront"><code>PorousStressCriterionTest_NumericalJacobian.mfront</code></a></li>
</ul>
<p>The first file declares:</p>
<ul>
<li>A set of aliases</li>
<li>A data structure holding the structure associated with the criterion.</li>
<li>Three functions which allows the computation of:
<ul>
<li>The value of the stress criterion for the given stress state.</li>
<li>The value of the stress criterion and its first derivative for the given stress state.</li>
<li>The value of the stress criterion and its first and second derivatives for the given stress state.</li>
</ul></li>
</ul>
<p>The second file give a skeleton required to implement those three functions.</p>
<p>Implementing a new stress criterion boils down to the following steps:</p>
<ol type="1">
<li>Rename those file to explicitly indicate the name of the stress criterion.</li>
<li>Replace the following strings by the appropriate values as described below:</li>
</ol>
<ul>
<li><code>__Author__</code></li>
<li><code>__Date__</code></li>
<li><code>__PorousStressCriterionName__</code></li>
<li><code>__STRESS_CRITERION_NAME__</code></li>
</ul>
<ol start="3" type="1">
<li>Implement the three previous functions</li>
<li>Test your implementation in <code>MFront</code> and <code>MTest</code> (or your favorite solver).</li>
</ol>
<h2 id="creating-a-proper-working-directory-for-the-example-of-the-so-called-hollow-sphere-criterion-proposed-by-michel-and-suquet"><span class="header-section-number">1.2</span> Creating a proper working directory for the example of the so-called hollow sphere criterion proposed by Michel and Suquet</h2>
<p>In this paragraph, we detail Steps 1 and 2. for the case of the so-called hollow sphere criterion proposed by Michel and Suquet criterion (see <span class="citation" data-cites="michel_constitutive_1992">[<a href="#ref-michel_constitutive_1992">1</a>]</span>) which will be used as an illustrative example throughout this document. We describe all those steps in details and finally gives a shell script that automates the whole process for <code>LiNuX</code> users. When providing command line examples, we assume that the shell is <code>bash</code>.</p>
<p>The header files <code>PorousStressCriterionTemplate.hxx</code> and <code>PorousStressCriterionTemplate.ixx</code> are placed in a subdirectory called <code>include/TFEL/Material</code> and renamed respectively <code>MichelAndSuquet1992HollowSphereTestStressCriterionTest.hxx</code> and <code>MichelAndSuquet1992HollowPorousStressCriterionTest.ixx</code>.</p>
<p>The <code>MFront</code> template files must be copied in the working directory and renamed appropriatly.</p>
<p>This can be done by taping the following commands in the terminal (under <code>LiNuX</code> or <code>Mac Os</code>):</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb2-1" data-line-number="1">$ <span class="fu">mkdir</span> -p include/TFEL/Material</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">$ <span class="fu">mkdir</span> -p tests/test1</a>
<a class="sourceLine" id="cb2-3" data-line-number="3">$ <span class="fu">mv</span> PorousStressCriterionTemplate.hxx \</a>
<a class="sourceLine" id="cb2-4" data-line-number="4">     include/TFEL/Material/MichelAndSuquet1992HollowSphereTestStressCriterion.hxx</a>
<a class="sourceLine" id="cb2-5" data-line-number="5">$ <span class="fu">mv</span> PorousStressCriterionTemplate.ixx \</a>
<a class="sourceLine" id="cb2-6" data-line-number="6">     include/TFEL/Material/MichelAndSuquet1992HollowSphereTestStressCriterion.ixx</a>
<a class="sourceLine" id="cb2-7" data-line-number="7">$ <span class="fu">mv</span> PorousStressCriterionTest.mfront \</a>
<a class="sourceLine" id="cb2-8" data-line-number="8">     tests/test1/MichelAndSuquet1992HollowSphereTestViscoPlasticity.mfront</a>
<a class="sourceLine" id="cb2-9" data-line-number="9">$ <span class="fu">mv</span> PorousStressCriterionTest_NumericalJacobian.mfront \</a>
<a class="sourceLine" id="cb2-10" data-line-number="10">     tests/test1/MichelAndSuquet1992HollowSphereTestViscoPlasticity_NumericalJacobian.mfront</a></code></pre></div>
<p>The working directory is thus organized as follows:</p>
<p><img src="img/ExtendingStandardElastoViscoPlasticityBrick-PorousStressCriterion-tree.png" style="width:100.0%" /></p>
<p>In all those files, we now replace</p>
<ul>
<li><code>__Author__</code> by <code>Thomas Helfer, Jérémy Hure, Mohamed Shokeir</code></li>
<li><code>__Date__</code> by <code>20/07/2020</code></li>
<li><code>__StressCriterionName__</code> by <code>MichelAndSuquet1992HollowSphereTest</code></li>
<li><code>__STRESS_CRITERION_NAME__</code> by <code>MICHEL_SUQUET_1992_HOLLOW_SPHERE_TEST</code></li>
</ul>
<p>You may use your favourite text-editor to do this or use the following command (for <code>LiNuX</code> users) :</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw">for</span> <span class="ex">f</span> in <span class="va">$(</span><span class="fu">find</span> . -type f<span class="va">)</span><span class="kw">;</span>                                                <span class="kw">\</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="kw">do</span> <span class="fu">sed</span> -i                                                                  \</a>
<a class="sourceLine" id="cb3-3" data-line-number="3">  -e <span class="st">&#39;s|__Author__|Thomas Helfer, Jérémy Hure, Mohamed Shokeir|g;&#39;</span>         \</a>
<a class="sourceLine" id="cb3-4" data-line-number="4">  -e <span class="st">&#39;s|__Date__|24/03/2020|g;&#39;</span>                                            \</a>
<a class="sourceLine" id="cb3-5" data-line-number="5">  -e <span class="st">&#39;s|__StressCriterionName__|MichelAndSuquet1992HollowSphereTest|g;&#39;</span>                        \</a>
<a class="sourceLine" id="cb3-6" data-line-number="6">  -e <span class="st">&#39;s|__STRESS_CRITERION_NAME__|MICHEL_SUQUET_1992_HOLLOW_SPHERE_TEST|g&#39;</span> <span class="va">$f</span> <span class="kw">;</span> <span class="kw">\</span></a>
<a class="sourceLine" id="cb3-7" data-line-number="7"><span class="kw">done</span></a></code></pre></div>
<p>All those steps are summarized in the following script, which can be downloaded <a href="scripts/generate-porous.sh">here</a>.</p>
<p>In conclusion, a recommended for starting the development of the a new stress criterion is to download the previous script, modify appropriately the first lines to match your need and run it.</p>
<blockquote>
<p><strong>Note</strong></p>
<p>At this stage, you shall already be able to verify that the provided <code>MFront</code> implementations barely compiles by typing in the <code>tests/test1</code> directory:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="ex">mfront</span> -I <span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span>/../../include --obuild \</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">       --interface=generic        \</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">       MichelAndSuquet1992HollowSphereTestPerfectPlasticity.mfront</a></code></pre></div>
<p>Note the <code>-I $(pwd)/../../include</code> flags which allows <code>MFront</code> to find the header files implementing the stress criterion (In <code>bash</code>, <code>$(pwd)</code> return the current directory).</p>
</blockquote>
<h2 id="implementing-the-michel-and-suquet-hollow-sphere-stress-criterion"><span class="header-section-number">1.3</span> Implementing the Michel and Suquet’ hollow sphere stress criterion</h2>
<p>In this paragraph, we detail all the steps required to implement the Michel and Suquet’ hollow sphere stress criterion. In a new directory, we just follow the steps given by the previous paragraph:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="fu">wget</span> http://tfel.sourceforge.net/scripts/generate-porous.sh</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="fu">chmod</span> +x generate-porous.sh</a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="ex">./generate-porous.sh</span></a></code></pre></div>
<h3 id="modifying-the-michelandsuquet1992hollowsphereteststresscriterionparameters-data-structure"><span class="header-section-number">1.3.1</span> Modifying the <code>MichelAndSuquet1992HollowSphereTestStressCriterionParameters</code> data structure</h3>
<p>The <code>MichelAndSuquet1992HollowSphereTestStressCriterionParameters</code> data structure, declared in <code>MichelAndSuquet1992HollowSphereTestStressCriterion.hxx</code>, must contain the values of the Norton exponent of the matrix <span class="math inline">\(n\)</span>.</p>
<p>In the implementation, we will also need to define two small values:</p>
<ul>
<li><code>feps</code>, which will be used to tell if the porosity is closed to its physical bounds, <span class="math inline">\(0\)</span> and <span class="math inline">\(1\)</span>.</li>
<li><code>feps2</code>, which will be used to regularise the derivative <span class="math inline">\({\displaystyle \frac{\displaystyle \partial A}{\displaystyle \partial f}}\)</span> as described below.</li>
</ul>
<p>We modify it as follows:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode cxx"><code class="sourceCode cpp"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw">template</span> &lt;<span class="kw">typename</span> StressStensor&gt;</a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="kw">struct</span> MichelAndSuquet1992HollowSphereTestStressCriterionParameters {</a>
<a class="sourceLine" id="cb6-3" data-line-number="3">  <span class="co">//! a simple alias</span></a>
<a class="sourceLine" id="cb6-4" data-line-number="4">  <span class="kw">using</span> real = MichelAndSuquet1992HollowSphereTestBaseType&lt;StressStensor&gt;;</a>
<a class="sourceLine" id="cb6-5" data-line-number="5">  <span class="co">//! </span><span class="an">\brief</span><span class="co"> </span><span class="an">\f$n\f$</span><span class="co"> is the Norton exponent of the matrix</span></a>
<a class="sourceLine" id="cb6-6" data-line-number="6">  real n;</a>
<a class="sourceLine" id="cb6-7" data-line-number="7">  <span class="co">//! </span><span class="an">\brief</span><span class="co"> </span><span class="an">\f$feps\f$</span><span class="co"> is a small numerical parameter</span></a>
<a class="sourceLine" id="cb6-8" data-line-number="8">  real feps = real(<span class="fl">1e-14</span>); </a>
<a class="sourceLine" id="cb6-9" data-line-number="9">  <span class="co">//! </span><span class="an">\brief</span><span class="co"> </span><span class="an">\f$feps\f$</span><span class="co"> is a small numerical parameter</span></a>
<a class="sourceLine" id="cb6-10" data-line-number="10">  real feps2 = real(<span class="fl">1e-5</span>); </a>
<a class="sourceLine" id="cb6-11" data-line-number="11">};  <span class="co">// end of struct MichelAndSuquet1992HollowSphereTestStressCriterionParameters</span></a></code></pre></div>
<p>This is the only modification of the <code>MichelAndSuquet1992HollowSphereTestStressCriterion.hxx</code> file.</p>
<h3 id="include-tfelmathgeneralieee754.hxx-header"><span class="header-section-number">1.3.2</span> Include <code>TFEL/Math/General/IEEE754.hxx</code> header</h3>
<p>The <code>TFEL/Math/General/IEEE754.hxx</code> header reimplements a set of standard functions which does not work as expected under <code>gcc</code> when the <code>-ffast-math</code> flag is used.</p>
<p>The header must be included at the top of the <code>MichelAndSuquet1992HollowSphereTestStressCriterion.ixx</code> file as follows:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode cxx"><code class="sourceCode cpp"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="pp">#include </span><span class="im">&quot;TFEL/Math/General/IEEE754.hxx&quot;</span></a></code></pre></div>
<h3 id="implementing-the-output-stream-operator-for-the-michelandsuquet1992hollowsphereteststresscriterionparameters-data-structure"><span class="header-section-number">1.3.3</span> Implementing the output stream operator for the <code>MichelAndSuquet1992HollowSphereTestStressCriterionParameters</code> data structure</h3>
<p>The output stream operator must now be implemented in the <code>MichelAndSuquet1992HollowSphereTestStressCriterion.ixx</code> file:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode cxx"><code class="sourceCode cpp"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw">template</span> &lt;<span class="kw">typename</span> StressStensor&gt;</a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="bu">std::</span>ostream &amp;<span class="kw">operator</span>&lt;&lt;(<span class="bu">std::</span>ostream &amp;os,</a>
<a class="sourceLine" id="cb8-3" data-line-number="3">                         <span class="at">const</span> MichelAndSuquet1992HollowSphereTestStressCriterionParameters&lt;StressStensor&gt; &amp;p) {</a>
<a class="sourceLine" id="cb8-4" data-line-number="4">  os &lt;&lt; <span class="st">&quot;{n: &quot;</span> &lt;&lt; p.n &lt;&lt; <span class="st">&quot;, feps: &quot;</span> &lt;&lt; p.feps &lt;&lt; <span class="st">&quot;, feps2: &quot;</span> &lt;&lt; p.feps2 &lt;&lt; <span class="st">&quot;}&quot;</span>;</a>
<a class="sourceLine" id="cb8-5" data-line-number="5">  <span class="cf">return</span> os;</a>
<a class="sourceLine" id="cb8-6" data-line-number="6">} <span class="co">// end of operator&lt;&lt;</span></a></code></pre></div>
<p>This operator is useful when compiling <code>MFront</code> files in <code>debug</code> mode.</p>
<h3 id="implementing-the-computemichelandsuquet1992hollowsphereteststress-function"><span class="header-section-number">1.3.4</span> Implementing the <code>computeMichelAndSuquet1992HollowSphereTestStress</code> function</h3>
<p>The <code>computeMichelAndSuquet1992HollowSphereTestStress</code> function is implemented in the <code>MichelAndSuquet1992HollowSphereTestStressCriterion.ixx</code> file.</p>
<p>The main difficulty is the computation of <span class="math inline">\(A{\left(f\right)}\)</span> when the porosity ends toward <span class="math inline">\(0\)</span>. The limit is well defined, but the intermediate expression <span class="math inline">\(f^{-1/n}\)</span> is undefined. To avoid this issue, we will use the following approximated expression:</p>
<p><span class="math display">\[
A_{\varepsilon}{\left(f\right)}={\left(n\,{\left(A_{0}{\left(f\right)}-1\right)}\right)}^{\frac{-2\,n}{n+1}}\quad\text{with}\quad
A_{0}{\left(f\right)}=
\left\{
\begin{aligned}
{\left(n\,{\left({\left({{\displaystyle \frac{\displaystyle f+f_{\varepsilon}}{\displaystyle 2}}}\right)}^{-1/n}-1\right)}\right)}^{\frac{-2\,n}{n+1}}&amp;\quad\text{if}\quad&amp;f\leq f_{\varepsilon}\\
{\left(n\,{\left(f^{-1/n}-1\right)}\right)}^{\frac{-2\,n}{n+1}}&amp;\quad\text{if}\quad&amp;f&gt; f_{\varepsilon}
\end{aligned}
\right.
\]</span></p>
<p>With this expression, this implementation is straightforward:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode cxx"><code class="sourceCode cpp"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw">template</span> &lt;<span class="kw">typename</span> StressStensor&gt;</a>
<a class="sourceLine" id="cb9-2" data-line-number="2">MichelAndSuquet1992HollowSphereTestStressType&lt;StressStensor&gt; computeMichelAndSuquet1992HollowSphereTestStress(</a>
<a class="sourceLine" id="cb9-3" data-line-number="3">    <span class="at">const</span> StressStensor&amp; sig,</a>
<a class="sourceLine" id="cb9-4" data-line-number="4">    <span class="at">const</span> MichelAndSuquet1992HollowSphereTestPorosityType&lt;StressStensor&gt; f,</a>
<a class="sourceLine" id="cb9-5" data-line-number="5">    <span class="at">const</span> MichelAndSuquet1992HollowSphereTestStressCriterionParameters&lt;StressStensor&gt;&amp; p,</a>
<a class="sourceLine" id="cb9-6" data-line-number="6">    <span class="at">const</span> MichelAndSuquet1992HollowSphereTestStressType&lt;StressStensor&gt; seps) {</a>
<a class="sourceLine" id="cb9-7" data-line-number="7">  <span class="co">// a simple alias to the underlying numeric type</span></a>
<a class="sourceLine" id="cb9-8" data-line-number="8">  <span class="kw">using</span> real = MichelAndSuquet1992HollowSphereTestBaseType&lt;StressStensor&gt;;</a>
<a class="sourceLine" id="cb9-9" data-line-number="9">  <span class="kw">constexpr</span> <span class="at">const</span> <span class="kw">auto</span> cste_3_2 = real(<span class="dv">3</span>) / <span class="dv">2</span>;</a>
<a class="sourceLine" id="cb9-10" data-line-number="10">  <span class="kw">constexpr</span> <span class="at">const</span> <span class="kw">auto</span> cste_9_4 = real(<span class="dv">9</span>) / <span class="dv">4</span>;</a>
<a class="sourceLine" id="cb9-11" data-line-number="11">  <span class="at">const</span> <span class="kw">auto</span> s = deviator(s);</a>
<a class="sourceLine" id="cb9-12" data-line-number="12">  <span class="at">const</span> <span class="kw">auto</span> s2 = cste_3_2 * (s | s);</a>
<a class="sourceLine" id="cb9-13" data-line-number="13">  <span class="at">const</span> <span class="kw">auto</span> pr = trace(sig) / <span class="dv">3</span>;</a>
<a class="sourceLine" id="cb9-14" data-line-number="14">  <span class="at">const</span> <span class="kw">auto</span> n = p.n;</a>
<a class="sourceLine" id="cb9-15" data-line-number="15">  <span class="at">const</span> <span class="kw">auto</span> is_zero = tfel::math::ieee754::fpclassify(f) == FP_ZERO;</a>
<a class="sourceLine" id="cb9-16" data-line-number="16">  <span class="at">const</span> <span class="kw">auto</span> A0 = f &lt; p.feps ? pow((f + p.feps) / <span class="dv">2</span>, <span class="dv">-1</span> / n) : pow(f, <span class="dv">-1</span> / n);</a>
<a class="sourceLine" id="cb9-17" data-line-number="17">  <span class="at">const</span> <span class="kw">auto</span> A = is_zero ? <span class="dv">0</span> : pow(n * (A0 - <span class="dv">1</span>), <span class="dv">-2</span> * n / (n + <span class="dv">1</span>));</a>
<a class="sourceLine" id="cb9-18" data-line-number="18">  <span class="at">const</span> <span class="kw">auto</span> B = (<span class="dv">1</span> + (<span class="dv">2</span> * f) / <span class="dv">3</span>) * pow(<span class="dv">1</span> - f, <span class="dv">-2</span> * n / (n + <span class="dv">1</span>));</a>
<a class="sourceLine" id="cb9-19" data-line-number="19">  <span class="cf">return</span> <span class="bu">std::</span>sqrt(cste_9_4 * A * pr * pr + B * s2);</a>
<a class="sourceLine" id="cb9-20" data-line-number="20">}  <span class="co">// end of computeMichelAndSuquet1992HollowSphereTestYieldStress</span></a></code></pre></div>
<blockquote>
<p><strong>Note</strong></p>
<p>It is worth trying to recompile the <code>MFront</code> file at this stage to see if one did not introduce any error in the <code>C++</code> code.</p>
</blockquote>
<h3 id="implementing-the-computemichelandsuquet1992hollowsphereteststressnormal-function"><span class="header-section-number">1.3.5</span> Implementing the <code>computeMichelAndSuquet1992HollowSphereTestStressNormal</code> function</h3>
<p>This function computes the equivalent stress, its normal and its derivative with respect to the porosity.</p>
<p>The expression of the normal is:</p>
<p><span class="math display">\[
\begin{aligned}
\underline{n}^{MS} &amp;= {\displaystyle \frac{\displaystyle \partial \sigma_{\mathrm{eq}}^{MS}}{\displaystyle \partial \underline{\sigma}}} =
{\displaystyle \frac{\displaystyle \partial \sigma_{\mathrm{eq}}^{MS}}{\displaystyle \partial p}}\,{\displaystyle \frac{\displaystyle \partial p}{\displaystyle \partial \underline{\sigma}}}+
{\displaystyle \frac{\displaystyle \partial \sigma_{\mathrm{eq}}^{MS}}{\displaystyle \partial \sigma_{\mathrm{eq}}}}\,{\displaystyle \frac{\displaystyle \partial \sigma_{\mathrm{eq}}}{\displaystyle \partial \underline{\sigma}}}\\
&amp;={{\displaystyle \frac{\displaystyle 3}{\displaystyle 2\,\sigma_{\mathrm{eq}}^{MS}}}}\,{\left({{\displaystyle \frac{\displaystyle 1}{\displaystyle 2}}}\,A\,p\,\underline{I}+B\,\underline{s}\right)}
\end{aligned}
\]</span></p>
<p>where <span class="math inline">\(\underline{s}\)</span> is the deviatoric part of the stress.</p>
<p>The expression of <span class="math inline">\({\displaystyle \frac{\displaystyle \partial \sigma_{\mathrm{eq}}^{MS}}{\displaystyle \partial f}}\)</span> is given by:</p>
<p><span class="math display">\[
{\displaystyle \frac{\displaystyle \partial \sigma_{\mathrm{eq}}^{MS}}{\displaystyle \partial f}}={{\displaystyle \frac{\displaystyle 1}{\displaystyle \sigma_{\mathrm{eq}}^{MS}}}}{\left({{\displaystyle \frac{\displaystyle 9}{\displaystyle 8}}}\,p^{2}\,{\displaystyle \frac{\displaystyle \partial A}{\displaystyle \partial f}}+{{\displaystyle \frac{\displaystyle 1}{\displaystyle 2}}}\,\sigma_{\mathrm{eq}}^{2}\,{\displaystyle \frac{\displaystyle \partial B}{\displaystyle \partial f}}\right)}
\]</span></p>
<p>The expression of <span class="math inline">\({\displaystyle \frac{\displaystyle \partial A}{\displaystyle \partial f}}\)</span> can be computed straightforwardly:</p>
<p><span class="math display">\[
{\displaystyle \frac{\displaystyle \partial A}{\displaystyle \partial f}}={{\displaystyle \frac{\displaystyle 2\,A_{0}{\left(f\right)}}{\displaystyle f\,{\left(A_{0}{\left(f\right)}-1\right)}\,{\left(n+1\right)}}}}\,A{\left(f\right)}
\]</span></p>
<p>However, this derivative tends to infinity when the porosity tends to zero. The following approximated expression will be used in practice:</p>
<p><span class="math display">\[
{\left({\displaystyle \frac{\displaystyle \partial A}{\displaystyle \partial f}}\right)}_{\varepsilon}={{\displaystyle \frac{\displaystyle 2\,A_{0}{\left(f\right)}}{\displaystyle {\left(f+f_{\varepsilon_{2}}\right)}\,{\left(A_{0}{\left(f\right)}-1\right)}\,{\left(n+1\right)}}}}\,A{\left(f\right)}
\]</span></p>
<p>Let us decompose <span class="math inline">\(B{\left(f\right)}\)</span> as the product of two terms:</p>
<p><span class="math display">\[
B{\left(f\right)}=B_{1}{\left(f\right)}\,B_{2}{\left(f\right)}
\]</span></p>
<p>with:</p>
<p>f- <span class="math inline">\(B_{1}{\left(f\right)}=1+{{\displaystyle \frac{\displaystyle 2}{\displaystyle 3}}}\,f\)</span> - <span class="math inline">\(B_{2}{\left(f\right)}={\left(1-f\right)}^{\frac{-2\,n}{n+1}}\)</span></p>
<p>The derivative <span class="math inline">\({\displaystyle \frac{\displaystyle \partial B}{\displaystyle \partial f}}\)</span> is thus:</p>
<p><span class="math display">\[
{\displaystyle \frac{\displaystyle \partial B}{\displaystyle \partial f}}=B_{2}{\left(f\right)}\,{\displaystyle \frac{\displaystyle \partial B_{1}}{\displaystyle \partial f}}+B_{1}{\left(f\right)}\,{\displaystyle \frac{\displaystyle \partial B_{2}}{\displaystyle \partial f}}
\]</span></p>
<p>with:</p>
<ul>
<li><span class="math inline">\({\displaystyle \frac{\displaystyle \partial B_{1}}{\displaystyle \partial f}}={{\displaystyle \frac{\displaystyle 2}{\displaystyle 3}}}\)</span></li>
<li><span class="math inline">\({\displaystyle \frac{\displaystyle \partial B_{2}}{\displaystyle \partial f}}={{\displaystyle \frac{\displaystyle 2\,n}{\displaystyle {\left(1-f\right)}\,{\left(n+1\right)}}}}\,B_{2}{\left(f\right)}\)</span></li>
</ul>
<p>This expression introduces the inverse of the equivalent stress which may lead to numerical troubles. To avoid those issues, a numerical threshold is introduced in the computation of the inverse in our implementation:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode cxx"><code class="sourceCode cpp"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw">template</span> &lt;<span class="kw">typename</span> StressStensor&gt;</a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="bu">std::</span>tuple&lt;MichelAndSuquet1992HollowSphereTestStressType&lt;StressStensor&gt;,</a>
<a class="sourceLine" id="cb10-3" data-line-number="3">           MichelAndSuquet1992HollowSphereTestStressNormalType&lt;StressStensor&gt;,</a>
<a class="sourceLine" id="cb10-4" data-line-number="4">           MichelAndSuquet1992HollowSphereTestStressDerivativeWithRespectToPorosityType&lt;StressStensor&gt;&gt;</a>
<a class="sourceLine" id="cb10-5" data-line-number="5">computeMichelAndSuquet1992HollowSphereTestStressNormal(</a>
<a class="sourceLine" id="cb10-6" data-line-number="6">    <span class="at">const</span> StressStensor &amp; sig,</a>
<a class="sourceLine" id="cb10-7" data-line-number="7">    <span class="at">const</span> MichelAndSuquet1992HollowSphereTestPorosityType&lt;StressStensor&gt; f,</a>
<a class="sourceLine" id="cb10-8" data-line-number="8">    <span class="at">const</span> MichelAndSuquet1992HollowSphereTestStressCriterionParameters&lt;</a>
<a class="sourceLine" id="cb10-9" data-line-number="9">        StressStensor&gt; &amp; p,</a>
<a class="sourceLine" id="cb10-10" data-line-number="10">    <span class="at">const</span> MichelAndSuquet1992HollowSphereTestStressType&lt;StressStensor&gt; seps) {</a>
<a class="sourceLine" id="cb10-11" data-line-number="11">  <span class="kw">using</span> real = MichelAndSuquet1992HollowSphereTestBaseType&lt;StressStensor&gt;;</a>
<a class="sourceLine" id="cb10-12" data-line-number="12">  <span class="kw">constexpr</span> <span class="at">const</span> <span class="kw">auto</span> id =</a>
<a class="sourceLine" id="cb10-13" data-line-number="13">      MichelAndSuquet1992HollowSphereTestStressNormalType&lt;StressStensor&gt;::Id();</a>
<a class="sourceLine" id="cb10-14" data-line-number="14">  <span class="kw">constexpr</span> <span class="at">const</span> <span class="kw">auto</span> cste_2_3 = real(<span class="dv">2</span>) / <span class="dv">3</span>;</a>
<a class="sourceLine" id="cb10-15" data-line-number="15">  <span class="kw">constexpr</span> <span class="at">const</span> <span class="kw">auto</span> cste_3_2 = real(<span class="dv">3</span>) / <span class="dv">2</span>;</a>
<a class="sourceLine" id="cb10-16" data-line-number="16">  <span class="kw">constexpr</span> <span class="at">const</span> <span class="kw">auto</span> cste_9_4 = real(<span class="dv">9</span>) / <span class="dv">4</span>;</a>
<a class="sourceLine" id="cb10-17" data-line-number="17">  <span class="at">const</span> <span class="kw">auto</span> s = deviator(sig);</a>
<a class="sourceLine" id="cb10-18" data-line-number="18">  <span class="at">const</span> <span class="kw">auto</span> s2 = cste_3_2 * (s | s);</a>
<a class="sourceLine" id="cb10-19" data-line-number="19">  <span class="at">const</span> <span class="kw">auto</span> pr = trace(sig) / <span class="dv">3</span>;</a>
<a class="sourceLine" id="cb10-20" data-line-number="20">  <span class="at">const</span> <span class="kw">auto</span> n = p.n;</a>
<a class="sourceLine" id="cb10-21" data-line-number="21">  <span class="at">const</span> <span class="kw">auto</span> d = <span class="dv">1</span> - f;</a>
<a class="sourceLine" id="cb10-22" data-line-number="22">  <span class="at">const</span> <span class="kw">auto</span> inv_d = <span class="dv">1</span> / <span class="bu">std::</span>max(d, p.feps);</a>
<a class="sourceLine" id="cb10-23" data-line-number="23">  <span class="at">const</span> <span class="kw">auto</span> is_zero = tfel::math::ieee754::fpclassify(f) == FP_ZERO;</a>
<a class="sourceLine" id="cb10-24" data-line-number="24">  <span class="at">const</span> <span class="kw">auto</span> A0 = f &lt; p.feps ? pow((f + p.feps) / <span class="dv">2</span>, <span class="dv">-1</span> / n) : pow(f, <span class="dv">-1</span> / n);</a>
<a class="sourceLine" id="cb10-25" data-line-number="25">  <span class="at">const</span> <span class="kw">auto</span> A = is_zero ? <span class="dv">0</span> : pow(n * (A0 - <span class="dv">1</span>), <span class="dv">-2</span> * n / (n + <span class="dv">1</span>));</a>
<a class="sourceLine" id="cb10-26" data-line-number="26">  <span class="at">const</span> <span class="kw">auto</span> B1 = <span class="dv">1</span> + cste_2_3 * f;</a>
<a class="sourceLine" id="cb10-27" data-line-number="27">  <span class="at">const</span> <span class="kw">auto</span> B2 = pow(<span class="dv">1</span> - f, <span class="dv">-2</span> * n / (n + <span class="dv">1</span>));</a>
<a class="sourceLine" id="cb10-28" data-line-number="28">  <span class="at">const</span> <span class="kw">auto</span> B = B1 * B2;</a>
<a class="sourceLine" id="cb10-29" data-line-number="29">  <span class="at">const</span> <span class="kw">auto</span> seq = <span class="bu">std::</span>sqrt(cste_9_4 * A * pr * pr + B * s2);</a>
<a class="sourceLine" id="cb10-30" data-line-number="30">  <span class="at">const</span> <span class="kw">auto</span> iseq = <span class="dv">1</span> / (<span class="bu">std::</span>max(seq, seps));</a>
<a class="sourceLine" id="cb10-31" data-line-number="31">  <span class="at">const</span> <span class="kw">auto</span> dseq_dsig = cste_3_2 * iseq * ((A * pr / <span class="dv">2</span>) * id + B * s);</a>
<a class="sourceLine" id="cb10-32" data-line-number="32">  <span class="at">const</span> <span class="kw">auto</span> dA_df = <span class="dv">2</span> * A * A0 / (<span class="bu">std::</span>max(f, p.feps2) * (A0 - <span class="dv">1</span>) * (n + <span class="dv">1</span>));</a>
<a class="sourceLine" id="cb10-33" data-line-number="33">  <span class="at">const</span> <span class="kw">auto</span> dB1_df = cste_2_3;</a>
<a class="sourceLine" id="cb10-34" data-line-number="34">  <span class="at">const</span> <span class="kw">auto</span> dB2_df = <span class="dv">2</span> * n * B2 * inv_d / (n + <span class="dv">1</span>);</a>
<a class="sourceLine" id="cb10-35" data-line-number="35">  <span class="at">const</span> <span class="kw">auto</span> dB_df = B1 * dB2_df + B2 * dB1_df;</a>
<a class="sourceLine" id="cb10-36" data-line-number="36">  <span class="at">const</span> <span class="kw">auto</span> dseq_df = (cste_9_4 * pr * pr * dA_df + s2 * dB_df) * (iseq / <span class="dv">2</span>);</a>
<a class="sourceLine" id="cb10-37" data-line-number="37">  <span class="cf">return</span> {seq, dseq_dsig, dseq_df};</a>
<a class="sourceLine" id="cb10-38" data-line-number="38">}  <span class="co">// end of computeMichelAndSuquet1992HollowSphereTestStressNormal</span></a></code></pre></div>
<blockquote>
<p><strong>Note</strong></p>
<p>At this stage, the <code>MFront</code> implementation based on a numerical jacobian could be fully functional if one modifies the <code>@InitLocalVarialbes</code> block to initialize the parameters of stress criterion.</p>
</blockquote>
<h3 id="implementing-the-computemichelandsuquet1992hollowsphereteststresssecondderivative-function"><span class="header-section-number">1.3.6</span> Implementing the <code>computeMichelAndSuquet1992HollowSphereTestStressSecondDerivative</code> function</h3>
<p>This function computes:</p>
<ul>
<li>the equivalent stress <span class="math inline">\(\sigma_{\mathrm{eq}}^{MS}\)</span>,</li>
<li>the normal <span class="math inline">\(\underline{n}^{MS}={\displaystyle \frac{\displaystyle \partial \sigma_{\mathrm{eq}}^{MS}}{\displaystyle \partial \underline{\sigma}}}\)</span></li>
<li>the derivative of the equivalent stress with respect to the porosity <span class="math inline">\({\displaystyle \frac{\displaystyle \partial \sigma_{\mathrm{eq}}^{MS}}{\displaystyle \partial f}}\)</span></li>
<li>the derivative of the normal with respect to the stress <span class="math inline">\({\displaystyle \frac{\displaystyle \partial \underline{n}^{MS}}{\displaystyle \partial \sigma}}\)</span>.</li>
<li>the derivative of the normal with respect to the porosity <span class="math inline">\({\displaystyle \frac{\displaystyle \partial \underline{n}^{MS}}{\displaystyle \partial f}}\)</span>.</li>
</ul>
<p>Let us write the normal as:</p>
<p><span class="math display">\[
\underline{n}^{MS}={{\displaystyle \frac{\displaystyle 1}{\displaystyle \sigma_{\mathrm{eq}}^{MS}}}}\,\underline{C}
\]</span></p>
<p>with <span class="math inline">\(\underline{C}={{\displaystyle \frac{\displaystyle 3}{\displaystyle 2}}}\,{\left({{\displaystyle \frac{\displaystyle 1}{\displaystyle 2}}}\,A\,p\,\underline{I}+B\,\underline{s}\right)}\)</span></p>
<p>The expression of the derivative of the normal with respect to the stress is then:</p>
<p><span class="math display">\[
{\displaystyle \frac{\displaystyle \partial \underline{n}^{MS}}{\displaystyle \partial \sigma}}=
{{\displaystyle \frac{\displaystyle 1}{\displaystyle \sigma_{\mathrm{eq}}^{MS}}}}\,{\left({\displaystyle \frac{\displaystyle \partial \underline{C}}{\displaystyle \partial \underline{\sigma}}}-\underline{n}^{MS}\,\otimes\,\underline{n}^{MS}\right)}
\]</span></p>
<p>with <span class="math inline">\({\displaystyle \frac{\displaystyle \partial \underline{C}}{\displaystyle \partial \underline{\sigma}}}={{\displaystyle \frac{\displaystyle 1}{\displaystyle 4}}}\,A\,\underline{I}\,\otimes\,\underline{I}+{{\displaystyle \frac{\displaystyle 3}{\displaystyle 2}}}\,B\,{\left(\underline{\underline{\mathbf{I}}}-\underline{I}\,\otimes\,\underline{I}\right)}\)</span></p>
<p>The expression of the derivative of the normal with respect to the stress can be computed as follows:</p>
<p><span class="math display">\[
{\displaystyle \frac{\displaystyle \partial \underline{n}^{MS}}{\displaystyle \partial f}}=
{{\displaystyle \frac{\displaystyle 1}{\displaystyle \sigma_{\mathrm{eq}}^{MS}}}}\,{\left({\displaystyle \frac{\displaystyle \partial \underline{C}}{\displaystyle \partial f}}-{\displaystyle \frac{\displaystyle \partial \sigma_{\mathrm{eq}}^{MS}}{\displaystyle \partial f}}\,\underline{n}^{MS}\right)}
\]</span></p>
<p>with <span class="math inline">\({\displaystyle \frac{\displaystyle \partial C}{\displaystyle \partial f}}={{\displaystyle \frac{\displaystyle 3}{\displaystyle 2}}}\,{\left({{\displaystyle \frac{\displaystyle 1}{\displaystyle 2}}}\,{\displaystyle \frac{\displaystyle \partial A}{\displaystyle \partial f}}\,p\,\underline{I}+{\displaystyle \frac{\displaystyle \partial B}{\displaystyle \partial f}}\,\underline{s}\right)}\)</span></p>
<p>The implementation of the <code>computeMichelAndSuquet1992HollowSphereTestStressSecondDerivative</code> function is then:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode cxx"><code class="sourceCode cpp"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="kw">template</span> &lt;<span class="kw">typename</span> StressStensor&gt;</a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="bu">std::</span>tuple&lt;MichelAndSuquet1992HollowSphereTestStressType&lt;StressStensor&gt;,</a>
<a class="sourceLine" id="cb11-3" data-line-number="3">           MichelAndSuquet1992HollowSphereTestStressNormalType&lt;StressStensor&gt;,</a>
<a class="sourceLine" id="cb11-4" data-line-number="4">           MichelAndSuquet1992HollowSphereTestStressDerivativeWithRespectToPorosityType&lt;StressStensor&gt;,</a>
<a class="sourceLine" id="cb11-5" data-line-number="5">           MichelAndSuquet1992HollowSphereTestStressSecondDerivativeType&lt;StressStensor&gt;,</a>
<a class="sourceLine" id="cb11-6" data-line-number="6">           MichelAndSuquet1992HollowSphereTestNormalDerivativeWithRespectToPorosityType&lt;StressStensor&gt;&gt;</a>
<a class="sourceLine" id="cb11-7" data-line-number="7">computeMichelAndSuquet1992HollowSphereTestStressSecondDerivative(</a>
<a class="sourceLine" id="cb11-8" data-line-number="8">    <span class="at">const</span> StressStensor&amp; sig,</a>
<a class="sourceLine" id="cb11-9" data-line-number="9">    <span class="at">const</span> MichelAndSuquet1992HollowSphereTestPorosityType&lt;StressStensor&gt; f,</a>
<a class="sourceLine" id="cb11-10" data-line-number="10">    <span class="at">const</span> MichelAndSuquet1992HollowSphereTestStressCriterionParameters&lt;StressStensor&gt;&amp; p,</a>
<a class="sourceLine" id="cb11-11" data-line-number="11">    <span class="at">const</span> MichelAndSuquet1992HollowSphereTestStressType&lt;StressStensor&gt; seps) {</a>
<a class="sourceLine" id="cb11-12" data-line-number="12">  <span class="kw">constexpr</span> <span class="at">const</span> <span class="kw">auto</span> N = tfel::math::StensorTraits&lt;StressStensor&gt;::dime;</a>
<a class="sourceLine" id="cb11-13" data-line-number="13">  <span class="kw">using</span> real = MichelAndSuquet1992HollowSphereTestBaseType&lt;StressStensor&gt;;</a>
<a class="sourceLine" id="cb11-14" data-line-number="14">  <span class="kw">using</span> normal = MichelAndSuquet1992HollowSphereTestStressNormalType&lt;StressStensor&gt;;</a>
<a class="sourceLine" id="cb11-15" data-line-number="15">  <span class="kw">using</span> Stensor4 = tfel::math::st2tost2&lt;N, real&gt;;</a>
<a class="sourceLine" id="cb11-16" data-line-number="16">  <span class="kw">constexpr</span> <span class="at">const</span> <span class="kw">auto</span> id = normal::Id();</a>
<a class="sourceLine" id="cb11-17" data-line-number="17">  <span class="kw">constexpr</span> <span class="at">const</span> <span class="kw">auto</span> cste_2_3 = real(<span class="dv">2</span>) / <span class="dv">3</span>;</a>
<a class="sourceLine" id="cb11-18" data-line-number="18">  <span class="kw">constexpr</span> <span class="at">const</span> <span class="kw">auto</span> cste_3_2 = real(<span class="dv">3</span>) / <span class="dv">2</span>;</a>
<a class="sourceLine" id="cb11-19" data-line-number="19">  <span class="kw">constexpr</span> <span class="at">const</span> <span class="kw">auto</span> cste_9_4 = real(<span class="dv">9</span>) / <span class="dv">4</span>;</a>
<a class="sourceLine" id="cb11-20" data-line-number="20">  <span class="at">const</span> <span class="kw">auto</span> s = deviator(sig);</a>
<a class="sourceLine" id="cb11-21" data-line-number="21">  <span class="at">const</span> <span class="kw">auto</span> s2 = cste_3_2 * (s | s);</a>
<a class="sourceLine" id="cb11-22" data-line-number="22">  <span class="at">const</span> <span class="kw">auto</span> pr = trace(sig) / <span class="dv">3</span>;</a>
<a class="sourceLine" id="cb11-23" data-line-number="23">  <span class="at">const</span> <span class="kw">auto</span> n = p.n;</a>
<a class="sourceLine" id="cb11-24" data-line-number="24">  <span class="at">const</span> <span class="kw">auto</span> d = <span class="dv">1</span> - f;</a>
<a class="sourceLine" id="cb11-25" data-line-number="25">  <span class="at">const</span> <span class="kw">auto</span> inv_d = <span class="dv">1</span> / <span class="bu">std::</span>max(d, p.feps);</a>
<a class="sourceLine" id="cb11-26" data-line-number="26">  <span class="at">const</span> <span class="kw">auto</span> is_zero = tfel::math::ieee754::fpclassify(f) == FP_ZERO;</a>
<a class="sourceLine" id="cb11-27" data-line-number="27">  <span class="at">const</span> <span class="kw">auto</span> A0 = f &lt; p.feps ? pow((f + p.feps) / <span class="dv">2</span>, <span class="dv">-1</span> / n) : pow(f, <span class="dv">-1</span> / n);</a>
<a class="sourceLine" id="cb11-28" data-line-number="28">  <span class="at">const</span> <span class="kw">auto</span> A = is_zero ? <span class="dv">0</span> : pow(n * (A0 - <span class="dv">1</span>), <span class="dv">-2</span> * n / (n + <span class="dv">1</span>));</a>
<a class="sourceLine" id="cb11-29" data-line-number="29">  <span class="at">const</span> <span class="kw">auto</span> B1 = <span class="dv">1</span> + cste_2_3 * f;</a>
<a class="sourceLine" id="cb11-30" data-line-number="30">  <span class="at">const</span> <span class="kw">auto</span> B2 = pow(<span class="dv">1</span> - f, <span class="dv">-2</span> * n / (n + <span class="dv">1</span>));</a>
<a class="sourceLine" id="cb11-31" data-line-number="31">  <span class="at">const</span> <span class="kw">auto</span> B = B1 * B2;</a>
<a class="sourceLine" id="cb11-32" data-line-number="32">  <span class="at">const</span> <span class="kw">auto</span> seq = <span class="bu">std::</span>sqrt(cste_9_4 * A * pr * pr + B * s2);</a>
<a class="sourceLine" id="cb11-33" data-line-number="33">  <span class="co">// derivatives with respect to the stress</span></a>
<a class="sourceLine" id="cb11-34" data-line-number="34">  <span class="at">const</span> <span class="kw">auto</span> iseq = <span class="dv">1</span> / (<span class="bu">std::</span>max(seq, seps));</a>
<a class="sourceLine" id="cb11-35" data-line-number="35">  <span class="at">const</span> <span class="kw">auto</span> C = cste_3_2 * ((A * pr / <span class="dv">2</span>) * id + B * s);</a>
<a class="sourceLine" id="cb11-36" data-line-number="36">  <span class="at">const</span> <span class="kw">auto</span> dseq_dsig = iseq * C;</a>
<a class="sourceLine" id="cb11-37" data-line-number="37">  <span class="at">const</span> <span class="kw">auto</span> dC_dsig = cste_3_2 * ((A / <span class="dv">6</span>) * (id ^ id) + B * Stensor4::K());</a>
<a class="sourceLine" id="cb11-38" data-line-number="38">  <span class="at">const</span> <span class="kw">auto</span> d2seq_dsigdsig = iseq * (dC_dsig - (dseq_dsig ^ dseq_dsig));</a>
<a class="sourceLine" id="cb11-39" data-line-number="39">  <span class="co">// derivatives with respect to the porosity</span></a>
<a class="sourceLine" id="cb11-40" data-line-number="40">  <span class="at">const</span> <span class="kw">auto</span> dA_df = <span class="dv">2</span> * A * A0 / (<span class="bu">std::</span>max(f, p.feps2) * (A0 - <span class="dv">1</span>) * (n + <span class="dv">1</span>));</a>
<a class="sourceLine" id="cb11-41" data-line-number="41">  <span class="at">const</span> <span class="kw">auto</span> dB1_df = cste_2_3;</a>
<a class="sourceLine" id="cb11-42" data-line-number="42">  <span class="at">const</span> <span class="kw">auto</span> dB2_df = <span class="dv">2</span> * n * inv_d * B2 / (n + <span class="dv">1</span>);</a>
<a class="sourceLine" id="cb11-43" data-line-number="43">  <span class="at">const</span> <span class="kw">auto</span> dB_df = B1 * dB2_df + B2 * dB1_df;</a>
<a class="sourceLine" id="cb11-44" data-line-number="44">  <span class="at">const</span> <span class="kw">auto</span> dseq_df = (cste_9_4 * pr * pr * dA_df + s2 * dB_df) * (iseq / <span class="dv">2</span>);</a>
<a class="sourceLine" id="cb11-45" data-line-number="45">  <span class="co">// derivative with respect to the porosity and the stress</span></a>
<a class="sourceLine" id="cb11-46" data-line-number="46">  <span class="at">const</span> <span class="kw">auto</span> dC_df = cste_3_2 * (pr * dA_df / <span class="dv">2</span> * id + dB_df * s);</a>
<a class="sourceLine" id="cb11-47" data-line-number="47">  <span class="at">const</span> <span class="kw">auto</span> d2seq_dsigdf = iseq * dC_df - iseq * dseq_df * dseq_dsig;</a>
<a class="sourceLine" id="cb11-48" data-line-number="48">  <span class="cf">return</span> {seq, dseq_dsig, dseq_df, d2seq_dsigdsig, d2seq_dsigdf};</a>
<a class="sourceLine" id="cb11-49" data-line-number="49">}  <span class="co">// end of computeMichelAndSuquet1992HollowSphereTestSecondDerivative</span></a></code></pre></div>
<h2 id="testing-the-derivatives-advanced-and-optional"><span class="header-section-number">1.4</span> Testing the derivatives (advanced and optional)</h2>
<p>At this stage, one may compare the values returned by <code>computeMichelAndSuquet1992HollowSphereTestSecondDerivative</code> to numerical approximations using a simple <code>C++</code> file.</p>
<p>We thus create a file called <code>test.cxx</code> the <code>tests/test1</code> directory. Here is its content:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode cxx"><code class="sourceCode cpp"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="pp">#include </span><span class="im">&quot;TFEL/Math/Stensor/StensorConceptIO.hxx&quot;</span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="pp">#include </span><span class="im">&quot;TFEL/Math/ST2toST2/ST2toST2ConceptIO.hxx&quot;</span></a>
<a class="sourceLine" id="cb12-3" data-line-number="3"><span class="pp">#include </span><span class="im">&quot;TFEL/Material/MichelAndSuquet1992HollowSphereTestStressCriterion.hxx&quot;</span></a>
<a class="sourceLine" id="cb12-4" data-line-number="4"><span class="pp">#include </span><span class="im">&lt;cstdlib&gt;</span></a>
<a class="sourceLine" id="cb12-5" data-line-number="5"><span class="pp">#include </span><span class="im">&lt;iostream&gt;</span></a>
<a class="sourceLine" id="cb12-6" data-line-number="6"></a>
<a class="sourceLine" id="cb12-7" data-line-number="7"><span class="dt">int</span> main() {</a>
<a class="sourceLine" id="cb12-8" data-line-number="8">  <span class="kw">using</span> <span class="kw">namespace</span> tfel::material;</a>
<a class="sourceLine" id="cb12-9" data-line-number="9">  <span class="kw">using</span> <span class="kw">namespace</span> tfel::math;</a>
<a class="sourceLine" id="cb12-10" data-line-number="10">  <span class="kw">using</span> stress = <span class="dt">double</span>;</a>
<a class="sourceLine" id="cb12-11" data-line-number="11">  <span class="kw">using</span> StressStensor = stensor&lt;<span class="dv">3u</span>, <span class="dt">double</span>&gt;;</a>
<a class="sourceLine" id="cb12-12" data-line-number="12">  <span class="at">const</span> <span class="kw">auto</span> seps = <span class="fl">1e-12</span> * <span class="fl">200e9</span>;</a>
<a class="sourceLine" id="cb12-13" data-line-number="13">  MichelAndSuquet1992HollowSphereTestStressCriterionParameters&lt;StressStensor&gt; params;</a>
<a class="sourceLine" id="cb12-14" data-line-number="14">  params.n = <span class="dv">8</span>;</a>
<a class="sourceLine" id="cb12-15" data-line-number="15"></a>
<a class="sourceLine" id="cb12-16" data-line-number="16">  StressStensor sig = {<span class="fl">20e6</span>, <span class="fl">0.</span>, <span class="fl">0.</span>, <span class="fl">0.</span>, <span class="fl">0.</span>, <span class="fl">0.</span>};  <span class="co">// value of the stress</span></a>
<a class="sourceLine" id="cb12-17" data-line-number="17">  <span class="at">const</span> <span class="kw">auto</span> f = <span class="fl">1e-2</span>;                             <span class="co">// value of the porosity</span></a>
<a class="sourceLine" id="cb12-18" data-line-number="18"></a>
<a class="sourceLine" id="cb12-19" data-line-number="19">  <span class="bu">std::</span>cout &lt;&lt; <span class="st">&quot;Testing the derivatives with respect to the stress</span><span class="sc">\n</span><span class="st">&quot;</span>;</a>
<a class="sourceLine" id="cb12-20" data-line-number="20"></a>
<a class="sourceLine" id="cb12-21" data-line-number="21">  <span class="kw">auto</span> seq = stress{};</a>
<a class="sourceLine" id="cb12-22" data-line-number="22">  <span class="kw">auto</span> n = MichelAndSuquet1992HollowSphereTestStressNormalType&lt;StressStensor&gt;{};</a>
<a class="sourceLine" id="cb12-23" data-line-number="23">  <span class="kw">auto</span> dseq_df = stress{};</a>
<a class="sourceLine" id="cb12-24" data-line-number="24">  <span class="kw">auto</span> dn_ds = MichelAndSuquet1992HollowSphereTestStressSecondDerivativeType&lt;StressStensor&gt;{};</a>
<a class="sourceLine" id="cb12-25" data-line-number="25">  <span class="kw">auto</span> dn_df = MichelAndSuquet1992HollowSphereTestStressNormalType&lt;StressStensor&gt;{};</a>
<a class="sourceLine" id="cb12-26" data-line-number="26">  <span class="bu">std::</span>tie(seq, n, dseq_df, dn_ds, dn_df) =</a>
<a class="sourceLine" id="cb12-27" data-line-number="27">      computeMichelAndSuquet1992HollowSphereTestStressSecondDerivative(sig, f, params, seps);</a>
<a class="sourceLine" id="cb12-28" data-line-number="28"></a>
<a class="sourceLine" id="cb12-29" data-line-number="29">  <span class="kw">auto</span> nn = MichelAndSuquet1992HollowSphereTestStressNormalType&lt;StressStensor&gt;{};</a>
<a class="sourceLine" id="cb12-30" data-line-number="30">  <span class="kw">auto</span> dn = MichelAndSuquet1992HollowSphereTestStressSecondDerivativeType&lt;StressStensor&gt;{};</a>
<a class="sourceLine" id="cb12-31" data-line-number="31"></a>
<a class="sourceLine" id="cb12-32" data-line-number="32">  <span class="cf">for</span> (<span class="dt">unsigned</span> <span class="dt">short</span> i = <span class="dv">0</span>; i != <span class="dv">6</span>; ++i) {</a>
<a class="sourceLine" id="cb12-33" data-line-number="33">    <span class="kw">auto</span> sig_p = sig;</a>
<a class="sourceLine" id="cb12-34" data-line-number="34">    sig_p[i] += <span class="fl">1e-8</span> * <span class="fl">20e6</span>;</a>
<a class="sourceLine" id="cb12-35" data-line-number="35"></a>
<a class="sourceLine" id="cb12-36" data-line-number="36">    <span class="kw">auto</span> seq_p = stress{};</a>
<a class="sourceLine" id="cb12-37" data-line-number="37">    <span class="kw">auto</span> n_p = MichelAndSuquet1992HollowSphereTestStressNormalType&lt;StressStensor&gt;{};</a>
<a class="sourceLine" id="cb12-38" data-line-number="38">    <span class="kw">auto</span> dseq_df_p = stress{};</a>
<a class="sourceLine" id="cb12-39" data-line-number="39">    <span class="kw">auto</span> dn_ds_p = MichelAndSuquet1992HollowSphereTestStressSecondDerivativeType&lt;StressStensor&gt;{};</a>
<a class="sourceLine" id="cb12-40" data-line-number="40">    <span class="kw">auto</span> dn_df_p = MichelAndSuquet1992HollowSphereTestStressNormalType&lt;StressStensor&gt;{};</a>
<a class="sourceLine" id="cb12-41" data-line-number="41">    <span class="bu">std::</span>tie(seq_p, n_p, dseq_df_p, dn_ds_p, dn_df_p) =</a>
<a class="sourceLine" id="cb12-42" data-line-number="42">        computeMichelAndSuquet1992HollowSphereTestStressSecondDerivative(sig_p, f, params, seps);</a>
<a class="sourceLine" id="cb12-43" data-line-number="43"></a>
<a class="sourceLine" id="cb12-44" data-line-number="44">    <span class="kw">auto</span> sig_m = sig;</a>
<a class="sourceLine" id="cb12-45" data-line-number="45">    sig_m[i] -= <span class="fl">1e-8</span> * <span class="fl">20e6</span>;</a>
<a class="sourceLine" id="cb12-46" data-line-number="46"></a>
<a class="sourceLine" id="cb12-47" data-line-number="47">    <span class="kw">auto</span> seq_m = stress{};</a>
<a class="sourceLine" id="cb12-48" data-line-number="48">    <span class="kw">auto</span> n_m = MichelAndSuquet1992HollowSphereTestStressNormalType&lt;StressStensor&gt;{};</a>
<a class="sourceLine" id="cb12-49" data-line-number="49">    <span class="kw">auto</span> dseq_df_m = stress{};</a>
<a class="sourceLine" id="cb12-50" data-line-number="50">    <span class="kw">auto</span> dn_ds_m = MichelAndSuquet1992HollowSphereTestStressSecondDerivativeType&lt;StressStensor&gt;{};</a>
<a class="sourceLine" id="cb12-51" data-line-number="51">    <span class="kw">auto</span> dn_df_m = MichelAndSuquet1992HollowSphereTestStressNormalType&lt;StressStensor&gt;{};</a>
<a class="sourceLine" id="cb12-52" data-line-number="52">    <span class="bu">std::</span>tie(seq_m, n_m, dseq_df_m, dn_ds_m, dn_df_m) =</a>
<a class="sourceLine" id="cb12-53" data-line-number="53">        computeMichelAndSuquet1992HollowSphereTestStressSecondDerivative(sig_m, f, params, seps);</a>
<a class="sourceLine" id="cb12-54" data-line-number="54"></a>
<a class="sourceLine" id="cb12-55" data-line-number="55">    nn(i) = (seq_p - seq_m) / (<span class="fl">2e-8</span> * <span class="fl">20e6</span>);</a>
<a class="sourceLine" id="cb12-56" data-line-number="56"></a>
<a class="sourceLine" id="cb12-57" data-line-number="57">    <span class="cf">for</span> (<span class="dt">unsigned</span> <span class="dt">short</span> j = <span class="dv">0</span>; j != <span class="dv">6</span>; ++j) {</a>
<a class="sourceLine" id="cb12-58" data-line-number="58">      dn(j, i) = (n_p[j] - n_m[j]) / (<span class="fl">2e-8</span> * <span class="fl">20e6</span>);</a>
<a class="sourceLine" id="cb12-59" data-line-number="59">    }</a>
<a class="sourceLine" id="cb12-60" data-line-number="60">  }</a>
<a class="sourceLine" id="cb12-61" data-line-number="61"></a>
<a class="sourceLine" id="cb12-62" data-line-number="62">  <span class="bu">std::</span>cout &lt;&lt; <span class="st">&quot;analytical normal: &quot;</span> &lt;&lt; n &lt;&lt; <span class="ch">&#39;</span><span class="sc">\n</span><span class="ch">&#39;</span>;</a>
<a class="sourceLine" id="cb12-63" data-line-number="63">  <span class="bu">std::</span>cout &lt;&lt; <span class="st">&quot;numerical normal: &quot;</span> &lt;&lt; nn &lt;&lt; <span class="st">&quot;</span><span class="sc">\n\n</span><span class="st">&quot;</span>;</a>
<a class="sourceLine" id="cb12-64" data-line-number="64"></a>
<a class="sourceLine" id="cb12-65" data-line-number="65">  <span class="bu">std::</span>cout &lt;&lt; <span class="st">&quot;Analytical derivative of the normal with respect to stress:</span><span class="sc">\n</span><span class="st">&quot;</span> &lt;&lt; dn_ds &lt;&lt; <span class="ch">&#39;</span><span class="sc">\n</span><span class="ch">&#39;</span>;</a>
<a class="sourceLine" id="cb12-66" data-line-number="66">  <span class="bu">std::</span>cout &lt;&lt; <span class="st">&quot;Numerical derivative of the normal with respect to stress:</span><span class="sc">\n</span><span class="st">&quot;</span> &lt;&lt; dn &lt;&lt; <span class="ch">&#39;</span><span class="sc">\n</span><span class="ch">&#39;</span>;</a>
<a class="sourceLine" id="cb12-67" data-line-number="67">  <span class="bu">std::</span>cout &lt;&lt; <span class="st">&quot;Difference:</span><span class="sc">\n</span><span class="st">&quot;</span> &lt;&lt; (dn - dn_ds) &lt;&lt; <span class="st">&quot;</span><span class="sc">\n\n</span><span class="st">&quot;</span>;</a>
<a class="sourceLine" id="cb12-68" data-line-number="68"></a>
<a class="sourceLine" id="cb12-69" data-line-number="69">  <span class="bu">std::</span>cout &lt;&lt; <span class="st">&quot;Testing the derivatives with respect to the porosity</span><span class="sc">\n</span><span class="st">&quot;</span>;</a>
<a class="sourceLine" id="cb12-70" data-line-number="70"></a>
<a class="sourceLine" id="cb12-71" data-line-number="71">  <span class="kw">auto</span> seq_p = stress{};</a>
<a class="sourceLine" id="cb12-72" data-line-number="72">  <span class="kw">auto</span> n_p = MichelAndSuquet1992HollowSphereTestStressNormalType&lt;StressStensor&gt;{};</a>
<a class="sourceLine" id="cb12-73" data-line-number="73">  <span class="kw">auto</span> dseq_df_p = stress{};</a>
<a class="sourceLine" id="cb12-74" data-line-number="74">  <span class="kw">auto</span> dn_ds_p = MichelAndSuquet1992HollowSphereTestStressSecondDerivativeType&lt;StressStensor&gt;{};</a>
<a class="sourceLine" id="cb12-75" data-line-number="75">  <span class="kw">auto</span> dn_df_p = MichelAndSuquet1992HollowSphereTestStressNormalType&lt;StressStensor&gt;{};</a>
<a class="sourceLine" id="cb12-76" data-line-number="76">  <span class="bu">std::</span>tie(seq_p, n_p, dseq_df_p, dn_ds_p, dn_df_p) =</a>
<a class="sourceLine" id="cb12-77" data-line-number="77">      computeMichelAndSuquet1992HollowSphereTestStressSecondDerivative(sig, f + <span class="fl">1e-8</span>, params, seps);</a>
<a class="sourceLine" id="cb12-78" data-line-number="78"></a>
<a class="sourceLine" id="cb12-79" data-line-number="79">  <span class="kw">auto</span> seq_m = stress{};</a>
<a class="sourceLine" id="cb12-80" data-line-number="80">  <span class="kw">auto</span> n_m = MichelAndSuquet1992HollowSphereTestStressNormalType&lt;StressStensor&gt;{};</a>
<a class="sourceLine" id="cb12-81" data-line-number="81">  <span class="kw">auto</span> dseq_df_m = stress{};</a>
<a class="sourceLine" id="cb12-82" data-line-number="82">  <span class="kw">auto</span> dn_ds_m = MichelAndSuquet1992HollowSphereTestStressSecondDerivativeType&lt;StressStensor&gt;{};</a>
<a class="sourceLine" id="cb12-83" data-line-number="83">  <span class="kw">auto</span> dn_df_m = MichelAndSuquet1992HollowSphereTestStressNormalType&lt;StressStensor&gt;{};</a>
<a class="sourceLine" id="cb12-84" data-line-number="84">  <span class="bu">std::</span>tie(seq_m, n_m, dseq_df_m, dn_ds_m, dn_df_m) =</a>
<a class="sourceLine" id="cb12-85" data-line-number="85">      computeMichelAndSuquet1992HollowSphereTestStressSecondDerivative(sig, f - <span class="fl">1e-8</span>, params, seps);</a>
<a class="sourceLine" id="cb12-86" data-line-number="86"></a>
<a class="sourceLine" id="cb12-87" data-line-number="87">  <span class="bu">std::</span>cout &lt;&lt; <span class="st">&quot;Analitical derivative of the equivalent stress with respect to the porosity: &quot;</span></a>
<a class="sourceLine" id="cb12-88" data-line-number="88">            &lt;&lt; dseq_df &lt;&lt; <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>;</a>
<a class="sourceLine" id="cb12-89" data-line-number="89">  <span class="bu">std::</span>cout &lt;&lt; <span class="st">&quot;Numerical derivative of the equivalent stress with respect to the porosity: &quot;</span></a>
<a class="sourceLine" id="cb12-90" data-line-number="90">            &lt;&lt; (seq_p - seq_m) / (<span class="fl">2e-8</span>) &lt;&lt; <span class="ch">&#39;</span><span class="sc">\n</span><span class="ch">&#39;</span>;</a>
<a class="sourceLine" id="cb12-91" data-line-number="91">  <span class="bu">std::</span>cout &lt;&lt; <span class="st">&quot;Analytical derivative of the normal with respect to the porosity: &quot;</span> &lt;&lt; dn_df &lt;&lt; <span class="ch">&#39;</span><span class="sc">\n</span><span class="ch">&#39;</span>;</a>
<a class="sourceLine" id="cb12-92" data-line-number="92">  <span class="bu">std::</span>cout &lt;&lt; <span class="st">&quot;Numerical derivative of the normal with respect to the porosity: &quot;</span> &lt;&lt; (n_p - n_m) / <span class="fl">2e-8</span> &lt;&lt; <span class="ch">&#39;</span><span class="sc">\n</span><span class="ch">&#39;</span>;</a>
<a class="sourceLine" id="cb12-93" data-line-number="93"></a>
<a class="sourceLine" id="cb12-94" data-line-number="94">  <span class="cf">return</span> EXIT_SUCCESS;</a>
<a class="sourceLine" id="cb12-95" data-line-number="95">}</a></code></pre></div>
<p>This file can be computed as follows:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb13-1" data-line-number="1">$ <span class="ex">g++</span> -I ../../include/ test.cxx -o test \</a>
<a class="sourceLine" id="cb13-2" data-line-number="2">  <span class="kw">`</span><span class="ex">tfel-config</span> --includes --libs --material --compiler-flags --cppflags --oflags --warning<span class="kw">`</span></a></code></pre></div>
<p>where the utility <code>tfel-config</code> have been used to get the appropriated compiler flags, paths to the headers and libraries of the <code>TFEL</code> project.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode cxx"><code class="sourceCode cpp"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="er">$</span> ./test </a>
<a class="sourceLine" id="cb14-2" data-line-number="2">Testing the derivatives with respect to the stress</a>
<a class="sourceLine" id="cb14-3" data-line-number="3">analytical normal: [ <span class="fl">1.0171</span> <span class="fl">-0.494272</span> <span class="fl">-0.494272</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> ]</a>
<a class="sourceLine" id="cb14-4" data-line-number="4">numerical normal: [ <span class="fl">1.0171</span> <span class="fl">-0.494272</span> <span class="fl">-0.494272</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> ]</a>
<a class="sourceLine" id="cb14-5" data-line-number="5"></a>
<a class="sourceLine" id="cb14-6" data-line-number="6">Analytical derivative of the normal with respect to stress:</a>
<a class="sourceLine" id="cb14-7" data-line-number="7">[[<span class="at">6</span>.<span class="at">14937e</span>-<span class="at">25</span>,-<span class="at">3</span>.<span class="at">62157e</span>-<span class="at">24</span>,-<span class="at">3</span>.<span class="at">62157e</span>-<span class="at">24</span>,<span class="at">0</span>,<span class="at">0</span>,<span class="at">0</span>]</a>
<a class="sourceLine" id="cb14-8" data-line-number="8"> [-<span class="at">3</span>.<span class="at">62157e</span>-<span class="at">24</span>,<span class="at">3</span>.<span class="at">88453e</span>-<span class="at">08</span>,-<span class="at">3</span>.<span class="at">67234e</span>-<span class="at">08</span>,<span class="at">0</span>,<span class="at">0</span>,<span class="at">0</span>]</a>
<a class="sourceLine" id="cb14-9" data-line-number="9"> [-<span class="at">3</span>.<span class="at">62157e</span>-<span class="at">24</span>,-<span class="at">3</span>.<span class="at">67234e</span>-<span class="at">08</span>,<span class="at">3</span>.<span class="at">88453e</span>-<span class="at">08</span>,<span class="at">0</span>,<span class="at">0</span>,<span class="at">0</span>]</a>
<a class="sourceLine" id="cb14-10" data-line-number="10"> [<span class="at">0</span>,<span class="at">0</span>,<span class="at">0</span>,<span class="at">7</span>.<span class="at">55687e</span>-<span class="at">08</span>,<span class="at">0</span>,<span class="at">0</span>]</a>
<a class="sourceLine" id="cb14-11" data-line-number="11"> [<span class="at">0</span>,<span class="at">0</span>,<span class="at">0</span>,<span class="at">0</span>,<span class="at">7</span>.<span class="at">55687e</span>-<span class="at">08</span>,<span class="at">0</span>]</a>
<a class="sourceLine" id="cb14-12" data-line-number="12"> [<span class="at">0</span>,<span class="at">0</span>,<span class="at">0</span>,<span class="at">0</span>,<span class="at">0</span>,<span class="at">7</span>.<span class="at">55687e</span>-<span class="at">08</span>]]</a>
<a class="sourceLine" id="cb14-13" data-line-number="13">Numerical derivative of the normal with respect to stress:</a>
<a class="sourceLine" id="cb14-14" data-line-number="14">[[<span class="at">0</span>,<span class="at">0</span>,<span class="at">0</span>,<span class="at">0</span>,<span class="at">0</span>,<span class="at">0</span>]</a>
<a class="sourceLine" id="cb14-15" data-line-number="15"> [-<span class="at">1</span>.<span class="at">38778e</span>-<span class="at">16</span>,<span class="at">3</span>.<span class="at">88453e</span>-<span class="at">08</span>,-<span class="at">3</span>.<span class="at">67234e</span>-<span class="at">08</span>,<span class="at">0</span>,<span class="at">0</span>,<span class="at">0</span>]</a>
<a class="sourceLine" id="cb14-16" data-line-number="16"> [-<span class="at">1</span>.<span class="at">38778e</span>-<span class="at">16</span>,-<span class="at">3</span>.<span class="at">67234e</span>-<span class="at">08</span>,<span class="at">3</span>.<span class="at">88453e</span>-<span class="at">08</span>,<span class="at">0</span>,<span class="at">0</span>,<span class="at">0</span>]</a>
<a class="sourceLine" id="cb14-17" data-line-number="17"> [<span class="at">0</span>,<span class="at">0</span>,<span class="at">0</span>,<span class="at">7</span>.<span class="at">55687e</span>-<span class="at">08</span>,<span class="at">0</span>,<span class="at">0</span>]</a>
<a class="sourceLine" id="cb14-18" data-line-number="18"> [<span class="at">0</span>,<span class="at">0</span>,<span class="at">0</span>,<span class="at">0</span>,<span class="at">7</span>.<span class="at">55687e</span>-<span class="at">08</span>,<span class="at">0</span>]</a>
<a class="sourceLine" id="cb14-19" data-line-number="19"> [<span class="at">0</span>,<span class="at">0</span>,<span class="at">0</span>,<span class="at">0</span>,<span class="at">0</span>,<span class="at">7</span>.<span class="at">55687e</span>-<span class="at">08</span>]]</a>
<a class="sourceLine" id="cb14-20" data-line-number="20">Difference:</a>
<a class="sourceLine" id="cb14-21" data-line-number="21">[[-<span class="at">6</span>.<span class="at">14937e</span>-<span class="at">25</span>,<span class="at">3</span>.<span class="at">62157e</span>-<span class="at">24</span>,<span class="at">3</span>.<span class="at">62157e</span>-<span class="at">24</span>,<span class="at">0</span>,<span class="at">0</span>,<span class="at">0</span>]</a>
<a class="sourceLine" id="cb14-22" data-line-number="22"> [-<span class="at">1</span>.<span class="at">38778e</span>-<span class="at">16</span>,-<span class="at">2</span>.<span class="at">87601e</span>-<span class="at">17</span>,-<span class="at">1</span>.<span class="at">66944e</span>-<span class="at">16</span>,<span class="at">0</span>,<span class="at">0</span>,<span class="at">0</span>]</a>
<a class="sourceLine" id="cb14-23" data-line-number="23"> [-<span class="at">1</span>.<span class="at">38778e</span>-<span class="at">16</span>,-<span class="at">1</span>.<span class="at">66944e</span>-<span class="at">16</span>,-<span class="at">2</span>.<span class="at">87601e</span>-<span class="at">17</span>,<span class="at">0</span>,<span class="at">0</span>,<span class="at">0</span>]</a>
<a class="sourceLine" id="cb14-24" data-line-number="24"> [<span class="at">0</span>,<span class="at">0</span>,<span class="at">0</span>,<span class="at">1</span>.<span class="at">32349e</span>-<span class="at">23</span>,<span class="at">0</span>,<span class="at">0</span>]</a>
<a class="sourceLine" id="cb14-25" data-line-number="25"> [<span class="at">0</span>,<span class="at">0</span>,<span class="at">0</span>,<span class="at">0</span>,<span class="at">1</span>.<span class="at">32349e</span>-<span class="at">23</span>,<span class="at">0</span>]</a>
<a class="sourceLine" id="cb14-26" data-line-number="26"> [<span class="at">0</span>,<span class="at">0</span>,<span class="at">0</span>,<span class="at">0</span>,<span class="at">0</span>,<span class="at">1</span>.<span class="at">32349e</span>-<span class="at">23</span>]]</a>
<a class="sourceLine" id="cb14-27" data-line-number="27"></a>
<a class="sourceLine" id="cb14-28" data-line-number="28">Testing the derivatives with respect to the porosity</a>
<a class="sourceLine" id="cb14-29" data-line-number="29">Analitical derivative of the equivalent stress with respect to the porosity: <span class="fl">2.95999e+07</span></a>
<a class="sourceLine" id="cb14-30" data-line-number="30">Numerical derivative of the equivalent stress with respect to the porosity: <span class="fl">2.95999e+07</span></a>
<a class="sourceLine" id="cb14-31" data-line-number="31">Analytical derivative of the normal with respect to the porosity:[ <span class="fl">1.47999</span> <span class="fl">-0.0357341</span> <span class="fl">-0.0357341</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> ]</a>
<a class="sourceLine" id="cb14-32" data-line-number="32">Numerical derivative of the normal with respect to the porosity:[ <span class="fl">1.47999</span> <span class="fl">-0.0357341</span> <span class="fl">-0.0357341</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> ]</a></code></pre></div>
<h2 id="modifying-the-mfront-implementations"><span class="header-section-number">1.5</span> Modifying the <code>MFront</code> implementations</h2>
<p>At this stage, the provided <code>MFront</code> implementations are almost working.</p>
<h3 id="parameters"><span class="header-section-number">1.5.1</span> Parameters</h3>
<p>First, we define three parameters:</p>
<ul>
<li><code>s0</code>, the reference stress.</li>
<li><code>de0</code>, the reference strain rate.</li>
<li><code>E</code>, is the Norton exponent of the matrix.</li>
</ul>
<div class="sourceCode" id="cb15"><pre class="sourceCode cxx"><code class="sourceCode cpp"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="er">@</span>Parameter stress s0 = <span class="fl">50e6</span>;</a>
<a class="sourceLine" id="cb15-2" data-line-number="2">s0.setEntryName(<span class="st">&quot;NortonReferenceStress&quot;</span>);</a>
<a class="sourceLine" id="cb15-3" data-line-number="3"></a>
<a class="sourceLine" id="cb15-4" data-line-number="4"><span class="er">@</span>Parameter strainrate de0 = <span class="fl">1e-4</span>;</a>
<a class="sourceLine" id="cb15-5" data-line-number="5">de0.setEntryName(<span class="st">&quot;NortonReferenceStrainRate&quot;</span>);</a>
<a class="sourceLine" id="cb15-6" data-line-number="6"></a>
<a class="sourceLine" id="cb15-7" data-line-number="7"><span class="er">@</span>Parameter real E = <span class="dv">8</span>;</a>
<a class="sourceLine" id="cb15-8" data-line-number="8">E.setEntryName(<span class="st">&quot;MatrixNortonExponent&quot;</span>);</a></code></pre></div>
<p>The Norton exponent is then passed to <code>params</code> data structure before the behaviour integration.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode cxx"><code class="sourceCode cpp"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="er">@</span>InitLocalVariables {</a>
<a class="sourceLine" id="cb16-2" data-line-number="2">  <span class="co">// initialize the stress criterion parameter</span></a>
<a class="sourceLine" id="cb16-3" data-line-number="3">  params.n = E;</a></code></pre></div>
<p>We could also define a parameter for <code>feps</code>, but the default value is sufficient.</p>
<h3 id="definition-of-the-flow-rule"><span class="header-section-number">1.5.2</span> Definition of the flow rule</h3>
<p>The residual associated with the viscoplastic strain is:</p>
<p><span class="math display">\[
\begin{aligned}
f_{\underline{\varepsilon}^{\mathrm{vp}}}
&amp;=\Delta\,\underline{\varepsilon}^{\mathrm{vp}}-\Delta\,t\,\dot{\varepsilon}_{0}\,{\left({{\displaystyle \frac{\displaystyle {\left.\sigma_{\mathrm{eq}}^{MS}\right|_{t+\theta\,\Delta\,t}}}{\displaystyle \sigma_{0}}}}\right)}^{E}\,{\left.\underline{n}^{MS}\right|_{t+\theta\,\Delta\,t}}
&amp;=\Delta\,\underline{\varepsilon}^{\mathrm{vp}}-\Delta\,t\,v^{p}\,{\left.\underline{n}^{MS}\right|_{t+\theta\,\Delta\,t}}
\end{aligned}
\]</span></p>
<p>with <span class="math inline">\(v^{p}=\dot{\varepsilon}_{0}\,{\left({{\displaystyle \frac{\displaystyle {\left.\sigma_{\mathrm{eq}}^{MS}\right|_{t+\theta\,\Delta\,t}}}{\displaystyle \sigma_{0}}}}\right)}^{n}\)</span></p>
<p>The jacobian blocks associated with this residual are:</p>
<p><span class="math display">\[
\begin{aligned}
{\displaystyle \frac{\displaystyle \partial f_{\underline{\varepsilon}^{\mathrm{vp}}}}{\displaystyle \partial \Delta\,\underline{\varepsilon}^{\mathrm{el}}}}&amp;=
-v^{p}\,\Delta\,t\,
\left[
  E\,{{\displaystyle \frac{\displaystyle 1}{\displaystyle {\left.\sigma_{\mathrm{eq}}^{MS}\right|_{t+\theta\,\Delta\,t}}}}}\,{\left.\underline{n}^{MS}\right|_{t+\theta\,\Delta\,t}}\,\otimes\,{\left.\underline{n}^{MS}\right|_{t+\theta\,\Delta\,t}}+
  {\displaystyle \frac{\displaystyle \partial \underline{n}^{MS}}{\displaystyle \partial \underline{\sigma}}}
\right]
\,\colon\,{\displaystyle \frac{\displaystyle \partial \underline{\sigma}}{\displaystyle \partial \Delta\,\underline{\varepsilon}^{\mathrm{el}}}}\\
&amp;=
-\theta\,v^{p}\,\Delta\,t\,
\left[
  E\,{{\displaystyle \frac{\displaystyle 1}{\displaystyle {\left.\sigma_{\mathrm{eq}}^{MS}\right|_{t+\theta\,\Delta\,t}}}}}\,{\left.\underline{n}^{MS}\right|_{t+\theta\,\Delta\,t}}\,\otimes\,{\left.\underline{n}^{MS}\right|_{t+\theta\,\Delta\,t}}+
  {\displaystyle \frac{\displaystyle \partial \underline{n}^{MS}}{\displaystyle \partial \underline{\sigma}}}
\right]
\,\colon\,{\left.\underline{\underline{\mathbf{D}}}\right|_{t+\theta\,\Delta\,t}}\\
{\displaystyle \frac{\displaystyle \partial f_{\underline{\varepsilon}^{\mathrm{vp}}}}{\displaystyle \partial \Delta\,p}}&amp;=\underline{\underline{\mathbf{I}}}\\
{\displaystyle \frac{\displaystyle \partial f_{\underline{\varepsilon}^{\mathrm{vp}}}}{\displaystyle \partial \Delta\,f}}&amp;=
-\theta\,v^{p}\,\Delta\,t\,
\left[
E\,{{\displaystyle \frac{\displaystyle 1}{\displaystyle {\left.\sigma_{\mathrm{eq}}^{MS}\right|_{t+\theta\,\Delta\,t}}}}}\,{\displaystyle \frac{\displaystyle \partial {\left.\sigma_{\mathrm{eq}}^{MS}\right|_{t+\theta\,\Delta\,t}}}{\displaystyle \partial f}}\,\underline{n}^{MS}+
{\displaystyle \frac{\displaystyle \partial {\left.\underline{n}^{MS}\right|_{t+\theta\,\Delta\,t}}}{\displaystyle \partial f}}
\right]
\end{aligned}
\]</span></p>
<p>Those implicit equations and derivatives may readily be implemented as follows:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode cxx"><code class="sourceCode cpp"><a class="sourceLine" id="cb17-1" data-line-number="1">  <span class="at">const</span> <span class="kw">auto</span> iseq = <span class="dv">1</span> / max(seq, seps);</a>
<a class="sourceLine" id="cb17-2" data-line-number="2">  <span class="at">const</span> <span class="kw">auto</span> vp = de0 * pow(seq / s0, E);</a>
<a class="sourceLine" id="cb17-3" data-line-number="3">  fevp -= dt * vp * n;</a>
<a class="sourceLine" id="cb17-4" data-line-number="4">  dfevp_ddeel = -theta * vp * dt * (E * iseq * (n ^ n) + dn_ds) * D;</a>
<a class="sourceLine" id="cb17-5" data-line-number="5">  dfevp_ddf = -theta * vp * dt * (E * iseq * dseq_df * n + dn_df);</a></code></pre></div>
<h3 id="testing"><span class="header-section-number">1.5.3</span> Testing</h3>
<p>At this stage, your implementations are fully functional. Go in the <code>tests/test1</code> subdirectory and compile the examples with:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb18-1" data-line-number="1">$ <span class="ex">mfront</span> -I <span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span>/../../include --obuild --interface=generic \</a>
<a class="sourceLine" id="cb18-2" data-line-number="2">         MichelAndSuquet1992HollowSphereTestViscoPlasticity.mfront              \</a>
<a class="sourceLine" id="cb18-3" data-line-number="3">         MichelAndSuquet1992HollowSphereTestViscoPlasticity_NumericalJacobian.mfront</a></code></pre></div>
<p>One may test it under a simple tensile test:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode cxx"><code class="sourceCode cpp"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="er">@</span>Author Thomas Helfer;</a>
<a class="sourceLine" id="cb19-2" data-line-number="2"><span class="er">@</span>Date <span class="dv">28</span>/<span class="bn">07</span>/<span class="dv">2018</span>;</a>
<a class="sourceLine" id="cb19-3" data-line-number="3"></a>
<a class="sourceLine" id="cb19-4" data-line-number="4"><span class="er">@</span>PredictionPolicy <span class="ch">&#39;LinearPrediction&#39;</span>;</a>
<a class="sourceLine" id="cb19-5" data-line-number="5"><span class="er">@</span>MaximumNumberOfSubSteps <span class="dv">1</span>;</a>
<a class="sourceLine" id="cb19-6" data-line-number="6"><span class="er">@</span>Behaviour&lt;generic&gt; <span class="ch">&#39;src/libBehaviour.so&#39;</span> <span class="ch">&#39;MichelAndSuquet1992HollowSphereTestViscoPlasticity&#39;</span>;</a>
<a class="sourceLine" id="cb19-7" data-line-number="7"></a>
<a class="sourceLine" id="cb19-8" data-line-number="8"><span class="er">@</span>Real <span class="ch">&#39;young&#39;</span> <span class="fl">200e9</span>;</a>
<a class="sourceLine" id="cb19-9" data-line-number="9"><span class="er">@</span>Real <span class="ch">&#39;nu&#39;</span> <span class="fl">0.3</span>;</a>
<a class="sourceLine" id="cb19-10" data-line-number="10"><span class="er">@</span>Real <span class="ch">&#39;sxx&#39;</span> <span class="fl">50e6</span>;</a>
<a class="sourceLine" id="cb19-11" data-line-number="11"><span class="er">@</span>ImposedStress <span class="ch">&#39;SXX&#39;</span> <span class="ch">&#39;sxx&#39;</span>;</a>
<a class="sourceLine" id="cb19-12" data-line-number="12"><span class="co">// Initial value of the elastic strain</span></a>
<a class="sourceLine" id="cb19-13" data-line-number="13"><span class="er">@</span>Real <span class="ch">&#39;EELXX0&#39;</span> <span class="ch">&#39;sxx/young&#39;</span>;</a>
<a class="sourceLine" id="cb19-14" data-line-number="14"><span class="er">@</span>Real <span class="ch">&#39;EELZZ0&#39;</span> <span class="ch">&#39;-nu*EELXX0&#39;</span>;</a>
<a class="sourceLine" id="cb19-15" data-line-number="15"><span class="er">@</span>InternalStateVariable <span class="ch">&#39;ElasticStrain&#39;</span> {<span class="ch">&#39;EELXX0&#39;</span>,<span class="ch">&#39;EELZZ0&#39;</span>,<span class="ch">&#39;EELZZ0&#39;</span>,<span class="fl">0.</span>,<span class="fl">0.</span>,<span class="fl">0.</span>};</a>
<a class="sourceLine" id="cb19-16" data-line-number="16"><span class="co">// Initial value of the total strain</span></a>
<a class="sourceLine" id="cb19-17" data-line-number="17"><span class="er">@</span>Strain {<span class="ch">&#39;EELXX0&#39;</span>,<span class="ch">&#39;EELZZ0&#39;</span>,<span class="ch">&#39;EELZZ0&#39;</span>,<span class="fl">0.</span>,<span class="fl">0.</span>,<span class="fl">0.</span>};</a>
<a class="sourceLine" id="cb19-18" data-line-number="18"><span class="co">// Initial value of the total stresses</span></a>
<a class="sourceLine" id="cb19-19" data-line-number="19"><span class="er">@</span>Stress {<span class="ch">&#39;sxx&#39;</span>,<span class="fl">0.</span>,<span class="fl">0.</span>,<span class="fl">0.</span>,<span class="fl">0.</span>,<span class="fl">0.</span>};</a>
<a class="sourceLine" id="cb19-20" data-line-number="20"></a>
<a class="sourceLine" id="cb19-21" data-line-number="21"><span class="co">//@InternalStateVariable &#39;Porosity&#39; 0.01;</span></a>
<a class="sourceLine" id="cb19-22" data-line-number="22"></a>
<a class="sourceLine" id="cb19-23" data-line-number="23"><span class="er">@</span>ExternalStateVariable <span class="ch">&#39;Temperature&#39;</span> <span class="fl">293.15</span>;</a>
<a class="sourceLine" id="cb19-24" data-line-number="24"></a>
<a class="sourceLine" id="cb19-25" data-line-number="25"><span class="er">@</span>Times {<span class="fl">0.</span>,<span class="dv">3600</span> in <span class="dv">20</span>};</a></code></pre></div>
<blockquote>
<p><strong>Note</strong></p>
<p>The numerical jacobian version fails (residual stagnation) if the initial porosity is null with this time discretization. The main reason is that the centered finite difference used to evaluate the jacobian numerically is wrong when bounds are imposed to some state variables (i.e. the pertubated porosity can’t be negative).</p>
<p>In the numerical jacobian case, one solution is to allow sub-steppings.</p>
</blockquote>
<p>This test allows checking that:</p>
<ul>
<li>The results are correct.</li>
<li>The jacobian of the implicit system is properly computed. One may check its value against a numerical jacobian as follows:</li>
</ul>
<div class="sourceCode" id="cb20"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb20-1" data-line-number="1">$ <span class="ex">mfront</span> -I <span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span>/../../include --obuild --interface=generic \</a>
<a class="sourceLine" id="cb20-2" data-line-number="2">         MichelAndSuquet1992HollowSphereTestViscoPlasticity.mfront              \</a>
<a class="sourceLine" id="cb20-3" data-line-number="3">         --@CompareToNumericalJacobian=true             \</a>
<a class="sourceLine" id="cb20-4" data-line-number="4">         --@PerturbationValueForNumericalJacobianComputation=1.e-8</a></code></pre></div>
<ul>
<li>The convergence of the implicit algorithm is quadratic (one may compile the <code>MFront</code> file using the <code>--debug</code> flag as follows:</li>
</ul>
<div class="sourceCode" id="cb21"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb21-1" data-line-number="1">$ <span class="ex">mfront</span> -I <span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span>/../../include --obuild --interface=generic \</a>
<a class="sourceLine" id="cb21-2" data-line-number="2">         MichelAndSuquet1992HollowSphereTestViscoPlasticity.mfront --debug</a></code></pre></div>
<ul>
<li>The convergence of <code>MTest</code> is quadratic, i.e. that the consistent tangent operator is correct (this is just another way of checking if the jacobian of the implicit system is correct):</li>
</ul>
<div class="sourceCode" id="cb22"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb22-1" data-line-number="1">$ <span class="ex">mtest</span> MichelAndSuquet1992HollowSphereTestViscoPlasticity.mtest                   \</a>
<a class="sourceLine" id="cb22-2" data-line-number="2">        --@CompareToNumericalTangentOperator=true          \</a>
<a class="sourceLine" id="cb22-3" data-line-number="3">        --@NumericalTangentOperatorPerturbationValue=1.e-8 \</a>
<a class="sourceLine" id="cb22-4" data-line-number="4">        --@TangentOperatorComparisonCriterium=1</a></code></pre></div>
<h1 id="extending-the-tfelmfront-library"><span class="header-section-number">2</span> Extending the <code>TFELMFront</code> library</h1>
<h2 id="updating-the-working-directory"><span class="header-section-number">2.1</span> Updating the working directory</h2>
<p>We recommend that you use the following template files:</p>
<ul>
<li><a href="cxx/mfront/include/MFront/BehaviourBrick/PorousStressCriterionTemplate.hxx"><code>PorousStressCriterionTemplate.hxx</code></a>. Beware that this file is not the same as the one used in the first part of this document.</li>
<li><a href="cxx/mfront/src/PorousStressCriterionTemplate.cxx"><code>PorousStressCriterionTemplate.cxx</code></a></li>
</ul>
<p>The first file must be copied in a directory called <code>mfront/include/MFront/BehaviourBrick</code> and the second one in a directory called <code>mfront/src</code> subdirectory. Both must be renamed appropriately.</p>
<p>The working directory must now have the following structure:</p>
<p><img src="img/ExtendingStandardElastoViscoPlasticityBrick-PorousStressCriterion-tree-2.png" style="width:100.0%" /></p>
<p>As in the first part of this document, <code>__Author__</code>, <code>__Date__</code>, <code>__StressCriterionName__</code> and <code>__STRESS_CRITERION_NAME__</code> must be replaced by the appropriate values.</p>
<h2 id="adding-the-stress-criterion-options"><span class="header-section-number">2.2</span> Adding the stress criterion options</h2>
<p>In our case, the <code>getOptions</code> method must be implemented to declare the <code>n</code> material coefficient:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode cxx"><code class="sourceCode cpp"><a class="sourceLine" id="cb23-1" data-line-number="1"><span class="bu">std::</span>vector&lt;OptionDescription&gt; MichelAndSuquet1992HollowSphereTestStressCriterion::getOptions() <span class="at">const</span> {</a>
<a class="sourceLine" id="cb23-2" data-line-number="2">  <span class="kw">auto</span> opts = PorousStressCriterionBase::getOptions();</a>
<a class="sourceLine" id="cb23-3" data-line-number="3">  opts.emplace_back(<span class="st">&quot;n&quot;</span>, <span class="st">&quot;Norton exponent of the matrix&quot;</span>,</a>
<a class="sourceLine" id="cb23-4" data-line-number="4">                    OptionDescription::MATERIALPROPERTY);</a>
<a class="sourceLine" id="cb23-5" data-line-number="5">  <span class="cf">return</span> opts;</a>
<a class="sourceLine" id="cb23-6" data-line-number="6">} <span class="co">// end of MichelAndSuquet1992HollowSphereTestStressCriterion::getOptions()</span></a></code></pre></div>
<p>The <code>getPorosityEffectOnEquivalentPlasticStrain</code> method must be modified. But default, its returns the <code>STANDARD_POROSITY_CORRECTION_ON_EQUIVALENT_PLASTIC_STRAIN</code> value which would define define the increment of the viscoplastic strain as:</p>
<p><span class="math display">\[
\Delta\,\underline{\varepsilon}^{\mathrm{vp}}= {\left(1-f\right)}\,\Delta\,p\,\underline{n}
\]</span></p>
<p>In the case of the stress criterion discussed in this tutorial, this <span class="math inline">\(1-f\)</span> correction shall not be taken into account. Hence, the correct implementation for this method is:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode cxx"><code class="sourceCode cpp"><a class="sourceLine" id="cb24-1" data-line-number="1">StressCriterion::PorosityEffectOnFlowRule</a>
<a class="sourceLine" id="cb24-2" data-line-number="2">MichelAndSuquet1992HollowSphereTestStressCriterion::getPorosityEffectOnEquivalentPlasticStrain() <span class="at">const</span> {</a>
<a class="sourceLine" id="cb24-3" data-line-number="3">  <span class="cf">return</span> StressCriterion::NO_POROSITY_EFFECT_ON_EQUIVALENT_PLASTIC_STRAIN;</a>
<a class="sourceLine" id="cb24-4" data-line-number="4">}  <span class="co">// end of MichelAndSuquet1992HollowSphereTestStressCriterion::getPorosityEffectOnEquivalentPlasticStrain()</span></a></code></pre></div>
<h2 id="compilation-of-the-mfront-plugin"><span class="header-section-number">2.3</span> Compilation of the <code>MFront</code> plugin</h2>
<blockquote>
<p><strong>Note</strong></p>
<p>This paragraph assumes that you are working under a standard <code>LiNuX</code> environment. In particular, we assume that you use <code>g++</code> as your <code>C++</code> compiler. This can easily be changed to match your needs.</p>
</blockquote>
<p>The <code>MichelAndSuquet1992HollowSphereTestStressCriterion.cxx</code> can now be compiled in a plugin as follows. Go in the <code>mfront/src</code> directory and type:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb25-1" data-line-number="1">$ <span class="ex">g++</span> -I ../include/ <span class="kw">`</span><span class="ex">tfel-config</span> --includes <span class="kw">`</span>            \</a>
<a class="sourceLine" id="cb25-2" data-line-number="2">      <span class="kw">`</span><span class="ex">tfel-config</span> --oflags --cppflags --compiler-flags<span class="kw">`</span>  \</a>
<a class="sourceLine" id="cb25-3" data-line-number="3">      -DMFRONT_ADITIONNAL_LIBRARY                         \</a>
<a class="sourceLine" id="cb25-4" data-line-number="4">      <span class="kw">`</span><span class="ex">tfel-config</span> --libs<span class="kw">`</span> -lTFELMFront                   \</a>
<a class="sourceLine" id="cb25-5" data-line-number="5">      --shared -fPIC MichelAndSuquet1992HollowSphereTestStressCriterion.cxx         \</a>
<a class="sourceLine" id="cb25-6" data-line-number="6">      -o libAdditionalStressCriteria.so</a></code></pre></div>
<p>The calls to <code>tfel-config</code> allows retrieving the paths to the <code>TFEL</code> headers and libraries. The <code>MFRONT_ADITIONNAL_LIBRARY</code> flag activate a portion of the source file whose only purpose is to register the <code>MichelAndSuquet1992HollowSphereTest</code> stress criterion in an abstract factory.</p>
<h2 id="testing-the-plugin"><span class="header-section-number">2.4</span> Testing the plugin</h2>
<p>To test the plugin, go in the <code>tests/test2</code> directory.</p>
<p>Create a file <code>MichelAndSuquet1992HollowSphereTestViscoPlasticity.mfront</code> with the following content:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode cxx"><code class="sourceCode cpp"><a class="sourceLine" id="cb26-1" data-line-number="1"><span class="er">@</span>DSL Implicit;</a>
<a class="sourceLine" id="cb26-2" data-line-number="2"></a>
<a class="sourceLine" id="cb26-3" data-line-number="3"><span class="er">@</span>Behaviour MichelAndSuquet1992HollowSphereTestViscoPlasticity;</a>
<a class="sourceLine" id="cb26-4" data-line-number="4"><span class="er">@</span>Author Thomas Helfer, Jérémy Hure, Mohamed Shokeir;</a>
<a class="sourceLine" id="cb26-5" data-line-number="5"><span class="er">@</span>Date <span class="dv">25</span> / <span class="bn">03</span> / <span class="dv">2020</span>;</a>
<a class="sourceLine" id="cb26-6" data-line-number="6"><span class="er">@</span>Description {</a>
<a class="sourceLine" id="cb26-7" data-line-number="7">}</a>
<a class="sourceLine" id="cb26-8" data-line-number="8"></a>
<a class="sourceLine" id="cb26-9" data-line-number="9"><span class="er">@</span>Algorithm NewtonRaphson;</a>
<a class="sourceLine" id="cb26-10" data-line-number="10"><span class="er">@</span>Epsilon <span class="dv">1</span>.e<span class="dv">-14</span>;</a>
<a class="sourceLine" id="cb26-11" data-line-number="11"><span class="er">@</span>Theta <span class="dv">1</span>;</a>
<a class="sourceLine" id="cb26-12" data-line-number="12"></a>
<a class="sourceLine" id="cb26-13" data-line-number="13"><span class="er">@</span>ModellingHypotheses{<span class="st">&quot;.+&quot;</span>};</a>
<a class="sourceLine" id="cb26-14" data-line-number="14"><span class="er">@</span>Brick StandardElastoViscoPlasticity{</a>
<a class="sourceLine" id="cb26-15" data-line-number="15">  stress_potential : <span class="st">&quot;Hooke&quot;</span> {</a>
<a class="sourceLine" id="cb26-16" data-line-number="16">    young_modulus : <span class="fl">200e9</span>,</a>
<a class="sourceLine" id="cb26-17" data-line-number="17">    poisson_ratio : <span class="fl">0.3</span>},</a>
<a class="sourceLine" id="cb26-18" data-line-number="18">  inelastic_flow : <span class="st">&quot;Norton&quot;</span> {</a>
<a class="sourceLine" id="cb26-19" data-line-number="19">    criterion : <span class="st">&quot;MichelAndSuquet1992HollowSphereTest&quot;</span> {</a>
<a class="sourceLine" id="cb26-20" data-line-number="20">      n : <span class="dv">8</span>},</a>
<a class="sourceLine" id="cb26-21" data-line-number="21">    n: <span class="dv">8</span>,</a>
<a class="sourceLine" id="cb26-22" data-line-number="22">    K: <span class="fl">50e6</span>,</a>
<a class="sourceLine" id="cb26-23" data-line-number="23">    A: <span class="dv">1</span>.e<span class="dv">-4</span></a>
<a class="sourceLine" id="cb26-24" data-line-number="24">  }</a>
<a class="sourceLine" id="cb26-25" data-line-number="25">};</a></code></pre></div>
<blockquote>
<p><strong>Note</strong></p>
<p>Here, we see that the Norton exponent has to be repeated twice:</p>
<ul>
<li>one for the definition of the stress criterion.</li>
<li>one for the definition of the Norton flow.</li>
</ul>
<p>This is due to the structure, i.e. the abstractions, used by the brick which considers that the inelastic flow has now knowledge of the stress criterion.</p>
</blockquote>
<p>This file can be compiled as follows:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb27-1" data-line-number="1">$ <span class="va">MFRONT_ADDITIONAL_LIBRARIES=</span>../../mfront/src/libAdditionalStressCriteria.so <span class="kw">\</span></a>
<a class="sourceLine" id="cb27-2" data-line-number="2">  <span class="ex">mfront</span> -I <span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span>/../../include/ --obuild --interface=generic                \</a>
<a class="sourceLine" id="cb27-3" data-line-number="3">  MichelAndSuquet1992HollowSphereTestViscoPlasticity.mfront</a></code></pre></div>
<p>This implementation can be checked with the same <code>MTest</code> file than in the first part of this tutorial.</p>
<h1 id="applications-to-uranimum-dioxyde-viscoplastic-behaviours"><span class="header-section-number">3</span> Applications to uranimum dioxyde viscoplastic behaviours</h1>
<h2 id="implementation-of-salvo-viscoplastic-behaviour"><span class="header-section-number">3.1</span> Implementation of Salvo’ viscoplastic behaviour</h2>
<p>This behaviour has been described in <span class="citation" data-cites="salvo_experimental_2015-1">[<a href="#ref-salvo_experimental_2015-1">2</a>]</span>.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode cxx"><code class="sourceCode cpp"><a class="sourceLine" id="cb28-1" data-line-number="1"><span class="er">@</span>DSL Implicit;</a>
<a class="sourceLine" id="cb28-2" data-line-number="2"></a>
<a class="sourceLine" id="cb28-3" data-line-number="3"><span class="er">@</span>Behaviour Salvo2015ViscoplasticBehaviour;</a>
<a class="sourceLine" id="cb28-4" data-line-number="4"><span class="er">@</span>Material UO2;</a>
<a class="sourceLine" id="cb28-5" data-line-number="5"><span class="er">@</span>Author Thomas Helfer, Jérémy Hure, Mohamed Shokeir;</a>
<a class="sourceLine" id="cb28-6" data-line-number="6"><span class="er">@</span>Date <span class="dv">25</span> / <span class="bn">03</span> / <span class="dv">2020</span>;</a>
<a class="sourceLine" id="cb28-7" data-line-number="7"><span class="er">@</span>Description {</a>
<a class="sourceLine" id="cb28-8" data-line-number="8">  <span class="st">&quot;Salvo, Maxime, Jérôme Sercombe, Thomas Helfer, Philippe Sornay, and Thierry Désoyer. &quot;</span></a>
<a class="sourceLine" id="cb28-9" data-line-number="9">  <span class="st">&quot;Experimental Characterization and Modeling of UO2 Grain Boundary Cracking at High &quot;</span></a>
<a class="sourceLine" id="cb28-10" data-line-number="10">  <span class="st">&quot;Temperatures and High Strain Rates.&quot;</span></a>
<a class="sourceLine" id="cb28-11" data-line-number="11">  <span class="st">&quot;Journal of Nuclear Materials 460 (May 2015): 184–99.&quot;</span></a>
<a class="sourceLine" id="cb28-12" data-line-number="12">  <span class="st">&quot;https://doi.org/10.1016/j.jnucmat.2015.02.018.&quot;</span></a>
<a class="sourceLine" id="cb28-13" data-line-number="13">}</a>
<a class="sourceLine" id="cb28-14" data-line-number="14"></a>
<a class="sourceLine" id="cb28-15" data-line-number="15"><span class="er">@</span>StrainMeasure Hencky;</a>
<a class="sourceLine" id="cb28-16" data-line-number="16"></a>
<a class="sourceLine" id="cb28-17" data-line-number="17"><span class="er">@</span>Algorithm NewtonRaphson;</a>
<a class="sourceLine" id="cb28-18" data-line-number="18"><span class="er">@</span>Epsilon <span class="dv">1</span>.e<span class="dv">-14</span>;</a>
<a class="sourceLine" id="cb28-19" data-line-number="19"><span class="er">@</span>Theta <span class="dv">1</span>;</a>
<a class="sourceLine" id="cb28-20" data-line-number="20"></a>
<a class="sourceLine" id="cb28-21" data-line-number="21"><span class="co">//! Reference stress</span></a>
<a class="sourceLine" id="cb28-22" data-line-number="22"><span class="er">@</span>Parameter stress s0 = <span class="fl">5e6</span>;</a>
<a class="sourceLine" id="cb28-23" data-line-number="23"><span class="co">//! Activation temperature</span></a>
<a class="sourceLine" id="cb28-24" data-line-number="24"><span class="co">// This temperature is equal to the activation energy (482 kJ/mol/K)</span></a>
<a class="sourceLine" id="cb28-25" data-line-number="25"><span class="co">// divided by the ideal gas constant.</span></a>
<a class="sourceLine" id="cb28-26" data-line-number="26"><span class="er">@</span>Parameter temperature Ta = <span class="fl">57971.27513059395</span>;</a>
<a class="sourceLine" id="cb28-27" data-line-number="27"><span class="co">//! Reference strain rate</span></a>
<a class="sourceLine" id="cb28-28" data-line-number="28"><span class="er">@</span>Parameter strainrate de0 = <span class="fl">29.130</span>;</a>
<a class="sourceLine" id="cb28-29" data-line-number="29"></a>
<a class="sourceLine" id="cb28-30" data-line-number="30"><span class="er">@</span>ModellingHypotheses{<span class="st">&quot;.+&quot;</span>};</a>
<a class="sourceLine" id="cb28-31" data-line-number="31"><span class="er">@</span>Brick StandardElastoViscoPlasticity{</a>
<a class="sourceLine" id="cb28-32" data-line-number="32">  stress_potential : <span class="st">&quot;Hooke&quot;</span> {</a>
<a class="sourceLine" id="cb28-33" data-line-number="33">    young_modulus : <span class="st">&quot;UO2_YoungModulus.mfront&quot;</span>,</a>
<a class="sourceLine" id="cb28-34" data-line-number="34">    poisson_ratio : <span class="st">&quot;UO2_PoissonRatio.mfront&quot;</span>},</a>
<a class="sourceLine" id="cb28-35" data-line-number="35">  inelastic_flow : <span class="st">&quot;HyperbolicSine&quot;</span> {</a>
<a class="sourceLine" id="cb28-36" data-line-number="36">    criterion : <span class="st">&quot;MichelAndSuquet1992HollowSphereTest&quot;</span> {</a>
<a class="sourceLine" id="cb28-37" data-line-number="37">      n : <span class="dv">6</span>},</a>
<a class="sourceLine" id="cb28-38" data-line-number="38">    K: <span class="st">&quot;s0&quot;</span>,</a>
<a class="sourceLine" id="cb28-39" data-line-number="39">    A: <span class="st">&quot;de0 * exp(-Ta/T)&quot;</span></a>
<a class="sourceLine" id="cb28-40" data-line-number="40">  }</a>
<a class="sourceLine" id="cb28-41" data-line-number="41">};</a></code></pre></div>
<blockquote>
<p><strong>Note</strong></p>
<p>This implementation has been proposed as an example of how the brick can be used in practice. This implementation barely compiles at this stage and shall be carefully verified before any usage in a fuel performance code.</p>
</blockquote>
<h2 id="coupling-of-the-salvo-viscoplastic-behaviour-with-the-ddif2-damage-law"><span class="header-section-number">3.2</span> Coupling of the Salvo’ viscoplastic behaviour with the <code>DDIF2</code> damage law</h2>
<p>The <code>DDIF2</code> damage law is currently the standard damage law used in <code>CEA</code>’ fuel performance codes (see <span class="citation" data-cites="michel_3d_2008 michel_3d_2016 michel_new_2017">[<a href="#ref-michel_3d_2008">3</a>–<a href="#ref-michel_new_2017">5</a>]</span> for a complete description). Coupling of the Salvo’ viscoplastic behaviour with the <code>DDIF2</code> damage law boils downs to replacing the <code>Hooke</code> stress potential with the <code>DDIF2</code> stress potential, as follows:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode cxx"><code class="sourceCode cpp"><a class="sourceLine" id="cb29-1" data-line-number="1"><span class="er">@</span>DSL Implicit;</a>
<a class="sourceLine" id="cb29-2" data-line-number="2"></a>
<a class="sourceLine" id="cb29-3" data-line-number="3"><span class="er">@</span>Behaviour DDIF2Salvo2015ViscoplasticBehaviour;</a>
<a class="sourceLine" id="cb29-4" data-line-number="4"><span class="er">@</span>Material UO2;</a>
<a class="sourceLine" id="cb29-5" data-line-number="5"><span class="er">@</span>Author Thomas Helfer, Jérémy Hure, Mohamed Shokeir;</a>
<a class="sourceLine" id="cb29-6" data-line-number="6"><span class="er">@</span>Date <span class="dv">25</span> / <span class="bn">03</span> / <span class="dv">2020</span>;</a>
<a class="sourceLine" id="cb29-7" data-line-number="7"><span class="er">@</span>Description {</a>
<a class="sourceLine" id="cb29-8" data-line-number="8">  <span class="st">&quot;Salvo, Maxime, Jérôme Sercombe, Thomas Helfer, Philippe Sornay, and Thierry Désoyer. &quot;</span></a>
<a class="sourceLine" id="cb29-9" data-line-number="9">  <span class="st">&quot;Experimental Characterization and Modeling of UO2 Grain Boundary Cracking at High &quot;</span></a>
<a class="sourceLine" id="cb29-10" data-line-number="10">  <span class="st">&quot;Temperatures and High Strain Rates.&quot;</span></a>
<a class="sourceLine" id="cb29-11" data-line-number="11">  <span class="st">&quot;Journal of Nuclear Materials 460 (May 2015): 184–99.&quot;</span></a>
<a class="sourceLine" id="cb29-12" data-line-number="12">  <span class="st">&quot;https://doi.org/10.1016/j.jnucmat.2015.02.018.&quot;</span></a>
<a class="sourceLine" id="cb29-13" data-line-number="13">}</a>
<a class="sourceLine" id="cb29-14" data-line-number="14"></a>
<a class="sourceLine" id="cb29-15" data-line-number="15"><span class="er">@</span>StrainMeasure Hencky;</a>
<a class="sourceLine" id="cb29-16" data-line-number="16"></a>
<a class="sourceLine" id="cb29-17" data-line-number="17"><span class="er">@</span>Algorithm NewtonRaphson;</a>
<a class="sourceLine" id="cb29-18" data-line-number="18"><span class="er">@</span>Epsilon <span class="dv">1</span>.e<span class="dv">-14</span>;</a>
<a class="sourceLine" id="cb29-19" data-line-number="19"><span class="er">@</span>Theta <span class="dv">1</span>;</a>
<a class="sourceLine" id="cb29-20" data-line-number="20"></a>
<a class="sourceLine" id="cb29-21" data-line-number="21"><span class="co">//! Reference stress</span></a>
<a class="sourceLine" id="cb29-22" data-line-number="22"><span class="er">@</span>Parameter stress s0 = <span class="fl">5e6</span>;</a>
<a class="sourceLine" id="cb29-23" data-line-number="23"><span class="co">//! Activation temperature</span></a>
<a class="sourceLine" id="cb29-24" data-line-number="24"><span class="co">// This temperature is equal to the activation energy (482 kJ/mol/K)</span></a>
<a class="sourceLine" id="cb29-25" data-line-number="25"><span class="co">// divided by the ideal gas constant.</span></a>
<a class="sourceLine" id="cb29-26" data-line-number="26"><span class="er">@</span>Parameter temperature Ta = <span class="fl">57971.27513059395</span>;</a>
<a class="sourceLine" id="cb29-27" data-line-number="27"><span class="co">//! Reference strain rate</span></a>
<a class="sourceLine" id="cb29-28" data-line-number="28"><span class="er">@</span>Parameter strainrate de0 = <span class="fl">29.130</span>;</a>
<a class="sourceLine" id="cb29-29" data-line-number="29"></a>
<a class="sourceLine" id="cb29-30" data-line-number="30"><span class="er">@</span>ModellingHypotheses{<span class="st">&quot;.+&quot;</span>};</a>
<a class="sourceLine" id="cb29-31" data-line-number="31"><span class="er">@</span>Brick StandardElastoViscoPlasticity{</a>
<a class="sourceLine" id="cb29-32" data-line-number="32">  stress_potential : <span class="st">&quot;DDIF2&quot;</span> {</a>
<a class="sourceLine" id="cb29-33" data-line-number="33">    young_modulus : <span class="st">&quot;UO2_YoungModulus.mfront&quot;</span>,</a>
<a class="sourceLine" id="cb29-34" data-line-number="34">    poisson_ratio : <span class="st">&quot;UO2_PoissonRatio.mfront&quot;</span>,</a>
<a class="sourceLine" id="cb29-35" data-line-number="35">    fracture_stress : <span class="st">&quot;UO2_ElasticLimit.mfront&quot;</span>,</a>
<a class="sourceLine" id="cb29-36" data-line-number="36">    fracture_energy : <span class="st">&quot;UO2_FractureEnergy.mfront&quot;</span></a>
<a class="sourceLine" id="cb29-37" data-line-number="37">  },</a>
<a class="sourceLine" id="cb29-38" data-line-number="38">  inelastic_flow : <span class="st">&quot;HyperbolicSine&quot;</span> {</a>
<a class="sourceLine" id="cb29-39" data-line-number="39">    criterion : <span class="st">&quot;MichelAndSuquet1992HollowSphereTest&quot;</span> {</a>
<a class="sourceLine" id="cb29-40" data-line-number="40">      n : <span class="dv">6</span>},</a>
<a class="sourceLine" id="cb29-41" data-line-number="41">    K: <span class="st">&quot;s0&quot;</span>,</a>
<a class="sourceLine" id="cb29-42" data-line-number="42">    A: <span class="st">&quot;de0 * exp(-Ta/T)&quot;</span></a>
<a class="sourceLine" id="cb29-43" data-line-number="43">  }</a>
<a class="sourceLine" id="cb29-44" data-line-number="44">};</a></code></pre></div>
<h1 id="references" class="unnumbered">References</h1>
<div id="refs" class="references">
<div id="ref-michel_constitutive_1992">
<p>1. <span class="smallcaps">Michel</span>, J. C. and <span class="smallcaps">Suquet</span>, P. The constitutive law of nonlinear viscous and porous materials. <em>Journal of the Mechanics and Physics of Solids</em>. 1 May 1992. Vol. 40, no. 4, p. 783–812. DOI <a href="https://doi.org/10.1016/0022-5096(92)90004-L">10.1016/0022-5096(92)90004-L</a>. Available from: <a href="http://www.sciencedirect.com/science/article/pii/002250969290004L" class="uri">http://www.sciencedirect.com/science/article/pii/002250969290004L</a></p>
</div>
<div id="ref-salvo_experimental_2015-1">
<p>2. <span class="smallcaps">Salvo</span>, Maxime, <span class="smallcaps">Sercombe</span>, Jérôme, <span class="smallcaps">Ménard</span>, Jean-Claude, <span class="smallcaps">Julien</span>, Jérôme, <span class="smallcaps">Helfer</span>, Thomas and <span class="smallcaps">Désoyer</span>, Thierry. Experimental characterization and modelling of UO2 behavior at high temperatures and high strain rates. <em>Journal of Nuclear Materials</em>. January 2015. Vol. 456, p. 54–67. DOI <a href="https://doi.org/10.1016/j.jnucmat.2014.09.024">10.1016/j.jnucmat.2014.09.024</a>. Available from: <a href="http://www.sciencedirect.com/science/article/pii/S002231151400614X" class="uri">http://www.sciencedirect.com/science/article/pii/S002231151400614X</a></p>
</div>
<div id="ref-michel_3d_2008">
<p>3. <span class="smallcaps">Michel</span>, Bruno, <span class="smallcaps">Sercombe</span>, Jérôme, <span class="smallcaps">Thouvenin</span>, Gilles and <span class="smallcaps">Chatelet</span>, Rémy. 3D fuel cracking modelling in pellet cladding mechanical interaction. <em>Engineering Fracture Mechanics</em>. July 2008. Vol. 75, no. 11, p. 3581–3598. DOI <a href="https://doi.org/10.1016/j.engfracmech.2006.12.014">10.1016/j.engfracmech.2006.12.014</a>. Available from: <a href="http://www.sciencedirect.com/science/article/pii/S0013794406004759" class="uri">http://www.sciencedirect.com/science/article/pii/S0013794406004759</a></p>
</div>
<div id="ref-michel_3d_2016">
<p>4. <span class="smallcaps">Michel</span>, Bruno, <span class="smallcaps">Helfer</span>, Thomas, <span class="smallcaps">Ramière</span>, Isabelle and <span class="smallcaps">Esnoul</span>, Coralie. 3D continuum damage approach for simulation of crack initiation and growth in ceramic materials. <em>Key Engineering Materials</em>. 2016. Vol. 713. DOI <a href="https://doi.org/10.4028/www.scientific.net/KEM.713.155">10.4028/www.scientific.net/KEM.713.155</a>. </p>
</div>
<div id="ref-michel_new_2017">
<p>5. <span class="smallcaps">Michel</span>, B., <span class="smallcaps">Helfer</span>, T., <span class="smallcaps">Ramière</span>, I. and <span class="smallcaps">Esnoul</span>, C. A new numerical methodology for simulation of unstable crack growth in time independent brittle materials. <em>Engineering Fracture Mechanics</em>. 12 August 2017. DOI <a href="https://doi.org/10.1016/j.engfracmech.2017.08.009">10.1016/j.engfracmech.2017.08.009</a>. Available from: <a href="http://www.sciencedirect.com/science/article/pii/S001379441630412X" class="uri">http://www.sciencedirect.com/science/article/pii/S001379441630412X</a></p>
</div>
</div>
        <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-62273823-1', 'auto');
      ga('send', 'pageview');
    </script>
  </body>
</html>
